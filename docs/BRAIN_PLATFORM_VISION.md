# COSMO Ecosystem & Brain Platform Vision

**Document Version:** 1.3  
**Date:** December 24, 2024  
**Status:** Planning / Vision â†’ Ready for Implementation  
**Authors:** JTR + Claude

---

> ### What's New in v1.3
> 
> - **The `.brain` as atomic unit** - Like .mp3 for music, .git for code
> - **Interface vision** - Adaptive workspace, not another developer tool
> - **The Collective** - We release the format, imagination runs
> - **The Unlock** - Minimum Viable Brain Package defined (CLI + library)
> - **Implementation Reality** - 90% reshaping existing data, not building new
> - **V2 Merge done** - All 7 upgrades already in production

---

> âš ï¸ **READ THIS FIRST**
> 
> This document contains a mix of:
> - **ACTUAL** - What currently exists in COSMO (verified against code/data)
> - **PROPOSED** - What we want to build for the Brain Platform
> 
> Each schema/section is clearly marked. Do not assume anything unmarked exists.
> When in doubt, check the codebase.

---

## Executive Summary

COSMO is an autonomous research system that produces **AI knowledge graphs** ("brains"). This document outlines the vision for a complete ecosystem where:

1. **COSMO** is the engine that produces brains
2. **Brain Platform** is the infrastructure for consuming, sharing, merging, and distributing brains
3. **Together** they create a flywheel of collective AI intelligence

Think: **Git + GitHub, but for AI knowledge.**

---

## Table of Contents

1. [The Vision](#the-vision)
2. [Core Concepts](#core-concepts)
3. [Architecture Overview](#architecture-overview)
4. [The `.brain` Specification](#the-brain-specification)
5. [COSMO Product](#cosmo-product)
6. [Brain Platform Product](#brain-platform-product)
7. [Integration Points](#integration-points)
8. [User Workflows](#user-workflows)
9. [Business Model](#business-model)
10. [Technical Roadmap](#technical-roadmap)
11. [Competitive Moat](#competitive-moat)
12. [Open Questions](#open-questions)

---

## The Vision

### The Problem

Today's AI systems are stateless. Each conversation starts fresh. Research done in one session doesn't compound into the next. Knowledge generated by AI is trapped in chat logs, scattered documents, and ephemeral contexts.

**And the tools we have suck.** GitHub is a developer tool built for code, not knowledge. IDEs are convoluted. There's no native space where humans and AI work together on knowledgeâ€”where the interface adapts to what you need (chat? editing? building? exploring?).

### The Solution

**Make AI knowledge portable, persistent, and collaborative.**

- **COSMO** runs autonomous research, building knowledge graphs over hours/days/weeks
- **Brains** are the packaged outputâ€”portable knowledge that can be shared, merged, and continued
- **The Interface** is an adaptive workspace where human + AI collaborate (we have this: intelligence dashboard, agent IDE)
- **The Collective** builds on top of the `.brain` format

### The `.brain` as Atomic Unit

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   The .brain is NOT just an export format.                         â”‚
â”‚   It's the UNIT OF VALUE in the knowledge economy.                 â”‚
â”‚                                                                     â”‚
â”‚   Like:                                                             â”‚
â”‚   â€¢ .mp3 made music shareable â†’ Napster, iTunes, Spotify           â”‚
â”‚   â€¢ .git made code collaborative â†’ GitHub, GitLab, ecosystem       â”‚
â”‚   â€¢ .brain makes knowledge composable â†’ The collective builds      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**We don't need to build all the interfaces. We need to release the format and let imagination run.**

### The Analogy

| Concept | Software World | COSMO Ecosystem |
|---------|---------------|-----------------|
| Work Unit | Code | Knowledge (nodes + edges) |
| Package | Repository | Brain |
| Tool | Git | COSMO |
| Platform | GitHub | Brain Platform |
| Operation | Commit, Push, Merge | Research, Push, Merge |
| **Atomic File** | **.git folder** | **.brain package** |

---

## Core Concepts

### Brain
A self-contained package of AI-generated knowledge, including:
- Memory graph (nodes, edges, clusters)
- Research artifacts (documents, code, data)
- Metadata (provenance, sources, lineage)

### Node
A single piece of knowledge with:
- Content (the actual knowledge)
- Embedding (vector representation)
- Metadata (source, confidence, timestamp)
- Connections (edges to related nodes)

### Edge
A relationship between nodes:
- Weight (strength of connection)
- Type (semantic relationship)
- Provenance (how it was discovered)

### Operations

| Operation | Description | Analogy |
|-----------|-------------|---------|
| **Run** | Execute COSMO to generate/extend a brain | Work on code |
| **Export** | Package a run as a `.brain` | `git archive` |
| **Import** | Load a brain into COSMO | `git clone` |
| **Push** | Upload brain to registry | `git push` |
| **Pull** | Download brain from registry | `git pull` |
| **Fork** | Copy a brain to start independent work | `git fork` |
| **Merge** | Combine multiple brains | `git merge` |
| **Diff** | Compare two brains | `git diff` |
| **View** | Explore a brain's contents | Browse code |

---

## The Interface Vision

### Not Another Developer Tool

The interface is NOT another GitHub. It's an **adaptive workspace** where human and AI work together:

| Mode | What It Becomes |
|------|-----------------|
| **Exploring** | Knowledge graph visualization, semantic search |
| **Chatting** | Conversational interface with the brain |
| **Building** | IDE for creating documents, code, artifacts |
| **Editing** | Document editor with AI assistance |
| **Researching** | Research dashboard with agent swarm |

**One space. Transforms to what you need.**

### What We Already Have (ACTUAL)

- âœ… **Intelligence Dashboard** - Monitor runs, explore knowledge, view agent activity
- âœ… **Agent IDE** - Spawn agents, manage goals, view outputs
- âœ… **Graph Visualization** - 3D force-directed knowledge graphs
- âœ… **Query Interface** - Semantic search, document compilation
- âœ… **Export/Trace** - BibTeX, markdown, full run archives

### What the Collective Will Build

Once `.brain` is released as a clean, portable format:

| What People Will Build | On Top Of |
|------------------------|-----------|
| Brain viewers | `.brain` + graph libraries |
| Brain chat apps | `.brain` + RAG pipelines |
| Brain-powered products | `.brain` + custom UI |
| Brain marketplaces | `.brain` + commerce |
| Educational platforms | `.brain` + curriculum |
| Research tools | `.brain` + analysis |
| Mobile apps | `.brain` + native UI |
| Obsidian/Notion plugins | `.brain` + integrations |

**We can't let the brains go to waste. The collective needs to get involved.**

---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚                         â˜ï¸  BRAIN CLOUD                                  â”‚
â”‚                    (Registry + Collaboration)                            â”‚
â”‚                                                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ Brain A â”‚  â”‚ Brain B â”‚  â”‚ Brain C â”‚  â”‚ Brain D â”‚  â”‚ Brain E â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
â”‚          â”‚            â”‚            â”‚            â”‚            â”‚          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                             â”‚                                            â”‚
â”‚                       PUSH / PULL / MERGE                                â”‚
â”‚                             â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚                                                           â”‚         â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚
â”‚   â”‚  â”‚   COSMO     â”‚    â”‚   COSMO     â”‚    â”‚   COSMO     â”‚   â”‚         â”‚
â”‚   â”‚  â”‚  Instance   â”‚    â”‚  Instance   â”‚    â”‚  Instance   â”‚   â”‚         â”‚
â”‚   â”‚  â”‚  (Alice)    â”‚    â”‚   (Bob)     â”‚    â”‚  (Acme Co)  â”‚   â”‚         â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚
â”‚   â”‚                                                           â”‚         â”‚
â”‚   â”‚              ğŸ–¥ï¸  DEPLOYED COSMOS                          â”‚         â”‚
â”‚   â”‚         (Self-hosted or COSMO Cloud)                      â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                    ğŸ‘ï¸  BRAIN VIEWER                         â”‚       â”‚
â”‚   â”‚              (Standalone exploration tool)                   â”‚       â”‚
â”‚   â”‚         Works offline with any .brain package                â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Responsibilities

| Component | Responsibility |
|-----------|---------------|
| **COSMO** | Produce brains through autonomous research |
| **Brain CLI** | Local brain operations (export, import, merge, diff) |
| **Brain Viewer** | Explore brain contents (standalone, read-only) |
| **Brain Cloud** | Host, share, and collaborate on brains |
| **Brain API** | Programmatic access to brain operations |

---

## The `.brain` Specification

> âš ï¸ **IMPORTANT: Actual vs. Aspirational**
> 
> This specification describes the **target format** for portable brain packages. 
> Some parts reflect **what currently exists** in COSMO (marked as ACTUAL), while 
> others are **proposed additions** for the brain export format (marked as PROPOSED).
> 
> **Currently exists:**
> - `state.json.gz` - Full cognitive state (memory, goals, agents, etc.)
> - `outputs/` - Agent-generated artifacts
> - `run-metadata.json` - Basic run info
> - `thoughts.jsonl` - Thought stream
> - `agents/` - Per-agent journals
> - `coordinator/` - Meta-coordinator reviews
> 
> **Proposed additions for `.brain` format:**
> - `manifest.json` - Standardized metadata with versioning
> - `metadata/sources.json` - Aggregated source catalog
> - `lineage/` - Merge/fork history tracking
> - `index/` - Pre-computed search indices

### Overview

A `.brain` is a directory (or compressed archive) containing all artifacts needed to represent, share, and continue AI knowledge work.

### Directory Structure

**What currently exists in a COSMO run folder:**
```
{run-name}/
â”œâ”€â”€ state.json.gz              # âœ… ACTUAL - Full cognitive state
â”œâ”€â”€ run-metadata.json          # âœ… ACTUAL - Run configuration
â”œâ”€â”€ thoughts.jsonl             # âœ… ACTUAL - Thought stream
â”œâ”€â”€ dreams.jsonl               # âœ… ACTUAL - Sleep consolidations
â”œâ”€â”€ agents/                    # âœ… ACTUAL - Per-agent journals (*.jsonl)
â”œâ”€â”€ outputs/                   # âœ… ACTUAL - Agent outputs
â”‚   â”œâ”€â”€ research/              #    Research corpus files
â”‚   â”œâ”€â”€ document-creation/     #    Generated documents
â”‚   â”œâ”€â”€ code-execution/        #    Code outputs
â”‚   â””â”€â”€ ...                    #    Other agent types
â”œâ”€â”€ coordinator/               # âœ… ACTUAL - Meta-coordinator reviews
â”œâ”€â”€ goals/                     # âœ… ACTUAL - Goal state files
â”œâ”€â”€ tasks/                     # âœ… ACTUAL - Task definitions
â”œâ”€â”€ plans/                     # âœ… ACTUAL - Active plans
â”œâ”€â”€ milestones/                # âœ… ACTUAL - Phase tracking
â”œâ”€â”€ checkpoints/               # âœ… ACTUAL - Recovery snapshots
â””â”€â”€ exports/                   # âœ… ACTUAL - Dashboard exports
```

**Proposed `.brain` package structure (to be built):**
```
{brain-name}.brain/
â”œâ”€â”€ manifest.json              # ğŸ†• PROPOSED - Standardized metadata
â”œâ”€â”€ state.json.gz              # âœ… FROM ACTUAL - Core memory graph
â”œâ”€â”€ run-metadata.json          # âœ… FROM ACTUAL - Run configuration
â”œâ”€â”€ metadata/                  # ğŸ†• PROPOSED
â”‚   â”œâ”€â”€ sources.json           #    Aggregated source catalog
â”‚   â”œâ”€â”€ topics.json            #    Domain taxonomy
â”‚   â””â”€â”€ statistics.json        #    Content statistics
â”œâ”€â”€ outputs/                   # âœ… FROM ACTUAL - Agent outputs
â”œâ”€â”€ lineage/                   # ğŸ†• PROPOSED
â”‚   â”œâ”€â”€ parents.json           #    Fork/merge history
â”‚   â””â”€â”€ changelog.md           #    Version history
â””â”€â”€ index/                     # ğŸ†• PROPOSED (optional)
    â””â”€â”€ clusters.json          #    Pre-computed search index
```

### run-metadata.json (ACTUAL - exists today)

This file **currently exists** in every COSMO run:

```json
{
  "created": "2025-12-23T22:55:14.033Z",
  "cleanStart": false,
  "explorationMode": "guided",
  "domain": "Business",
  "context": "History of business, modern practices, strategy...",
  "executionMode": "strict",
  "depth": "deep",
  "maxCycles": "100",
  "enableWebSearch": true,
  "enableSleep": true,
  "enableCodingAgents": true,
  "enableIntrospection": true,
  "maxConcurrent": 5,
  "fileAccessEnabled": true,
  "launcherVersion": "2.0-web"
}
```

### manifest.json Schema (PROPOSED - does not exist yet)

> âš ï¸ **NOTE:** This file does not currently exist. The `run-metadata.json` above has 
> configuration info but lacks versioning, checksums, and content statistics. 
> This manifest schema is **proposed** for standardized brain packaging.

```json
{
  "$schema": "https://cosmo.ai/schemas/brain/v1/manifest.json",
  "version": "1.0.0",
  "brain": {
    "id": "uuid-v4",
    "name": "physics-quantum-2024",
    "displayName": "Quantum Physics Research",
    "description": "Comprehensive research on quantum computing, error correction, and applications",
    "version": "2.1.0",
    "created": "2024-12-20T10:30:00Z",
    "updated": "2024-12-24T15:45:00Z"
  },
  "cosmo": {
    "version": "2.5.0",
    "instanceId": "cosmo-jtr-local",
    "totalCycles": 847,
    "totalAgentRuns": 234
  },
  "content": {
    "nodes": 2847,
    "edges": 8234,
    "clusters": 47,
    "documents": 23,
    "sources": 412
  },
  "topics": [
    "quantum computing",
    "error correction",
    "quantum algorithms",
    "quantum hardware"
  ],
  "license": "CC-BY-4.0",
  "visibility": "public",
  "lineage": {
    "parents": [
      {
        "id": "brain-abc123",
        "name": "physics-foundations-2024",
        "version": "1.0.0"
      }
    ],
    "mergedFrom": []
  },
  "checksums": {
    "state": "sha256:abc123...",
    "outputs": "sha256:def456..."
  }
}
```

### state.json.gz Schema (ACTUAL - as of Dec 2024)

The compressed state file contains the full COSMO cognitive state. This is the **actual** structure from a real run:

**Top-level keys:**
```
cycleCount, journal, memory, goals, roles, reflection, oscillator, 
cognitiveState, temporal, coordinator, agentExecutor, forkSystem, 
topicQueue, goalCurator, evaluation, executiveRing, guidedMissionPlan, 
completionTracker, lastSummarization, gpt5Stats, goalAllocator, 
clusterSync, clusterCoordinator, timestamp
```

**Memory structure:**
```json
{
  "memory": {
    "nodes": [
      {
        "id": 123,
        "concept": "Strategy as cognitive architecture: design choices that...",
        "tag": "introspection",
        "embedding": [0.123, -0.456, ...],
        "weight": 1.0,
        "activation": 0.0,
        "cluster": 12,
        "accessCount": 5,
        "created": "2024-12-20T10:30:00Z",
        "accessed": "2024-12-24T15:00:00Z"
      }
    ],
    "edges": [
      {
        "source": 123,
        "target": 456,
        "weight": 0.87,
        "type": "semantic",
        "created": "2024-12-20T11:00:00Z",
        "accessed": "2024-12-24T14:00:00Z"
      }
    ],
    "clusters": [[1, [123, 456, 789]], [2, [101, 102]]],
    "nextNodeId": 2848,
    "nextClusterId": 48
  }
}
```

**Goals structure:**
```json
{
  "goals": {
    "active": [["goal_123", { "description": "...", "priority": 0.8, ... }]],
    "completed": [...],
    "archived": [...],
    "nextGoalId": 150
  }
}
```

**Cognitive state:**
```json
{
  "cognitiveState": {
    "curiosity": 0.8,
    "mood": 0.7,
    "energy": 0.6,
    "mode": "active",
    "lastModeChange": "2024-12-24T10:00:00Z",
    "surpriseAccumulator": 0.5,
    "recentSuccesses": 10,
    "recentFailures": 2
  }
}
```

**Other key sections:**
- `journal` - Last 100 thoughts with cycle, role, thought text, reasoning, cognitive state
- `roles` - Dynamic role configurations
- `oscillator` - Focus/explore oscillation state
- `agentExecutor` - Agent registry and execution state
- `executiveRing` - Executive coordinator statistics
- `guidedMissionPlan` - Current mission plan (if guided mode)
- `evaluation` - Performance metrics
- `timestamp` - When state was saved

### metadata/sources.json Schema (PROPOSED - does not exist yet)

> âš ï¸ **NOTE:** This file does not currently exist in COSMO runs. Sources are tracked 
> within agent output files (e.g., `outputs/research/*/sources.json`) but not aggregated 
> at the run level. This schema is **aspirational** for the `.brain` export format.

```json
{
  "version": "1.0.0",
  "sources": [
    {
      "id": "src_001",
      "type": "arxiv",
      "identifier": "2401.12345",
      "title": "Quantum Error Correction: A Survey",
      "authors": ["Alice Smith", "Bob Jones"],
      "url": "https://arxiv.org/abs/2401.12345",
      "accessed": "2024-12-20T10:30:00Z",
      "citedBy": ["node_123", "node_456"]
    }
  ],
  "statistics": {
    "total": 412,
    "byType": {
      "arxiv": 89,
      "doi": 134,
      "web": 156,
      "wikipedia": 33
    }
  }
}
```

### lineage/parents.json Schema (PROPOSED - reshapes existing data)

> âœ… **UPDATE:** Lineage tracking **DOES exist** for merged brains! The merge tool creates
> `merge-report.json` with full `sourceRuns[]` data. See example from `_MegaMerge_12_13_25`:
> - 49 source runs tracked with name, cycles, nodes, edges, domain
> - Full merge statistics (deduplication rate, conflicts prevented)
> - Domain-specific quality metrics
>
> The proposed `lineage/parents.json` schema below is simply a **reshape** of existing 
> `merge-report.json` data, not new data collection.

```json
{
  "version": "1.0.0",
  "parents": [
    {
      "brainId": "brain-abc123",
      "name": "physics-foundations-2024",
      "version": "1.0.0",
      "relationship": "forked",
      "inheritedNodes": 1234,
      "timestamp": "2024-12-15T09:00:00Z"
    }
  ],
  "merges": [
    {
      "sourceBrainId": "brain-def456",
      "sourceName": "quantum-algorithms-2024",
      "sourceVersion": "1.2.0",
      "mergedAt": "2024-12-22T16:00:00Z",
      "nodesAdded": 567,
      "edgesAdded": 1234,
      "conflicts": 3,
      "conflictResolution": "source-priority"
    }
  ]
}
```

### File Size Guidelines

| Component | Typical Size | Max Recommended |
|-----------|--------------|-----------------|
| manifest.json | 2-5 KB | 100 KB |
| state.json.gz | 1-50 MB | 500 MB |
| metadata/* | 100 KB - 5 MB | 50 MB |
| outputs/* | 10 MB - 1 GB | 10 GB |
| index/* | 10-100 MB | 500 MB |
| **Total .brain** | 50 MB - 2 GB | 15 GB |

### Compression

- `state.json.gz` MUST be gzip compressed
- Other JSON files MAY be compressed (`.json.gz`)
- Binary files (embeddings.bin) are stored raw
- Archives (`.brain.tar.gz`) compress the entire directory

### Versioning

Brains use semantic versioning:
- **Major**: Breaking changes to knowledge structure
- **Minor**: New knowledge domains added
- **Patch**: Refinements, corrections, source additions

---

## Implementation Reality

> **Key Insight:** The `.brain` format is 90% a RESHAPING of existing data, not new data collection.
> The Merge V2 engine (`scripts/merge_runs.js`) already did the heavy lifting.

### What Already Exists (ACTUAL)

| Data Needed | Current Location | Status |
|-------------|------------------|--------|
| **Lineage (merged brains)** | `merge-report.json` â†’ `sourceRuns[]` | âœ… Full data |
| **Merge quality metrics** | `merge-confidence.json` â†’ `domainStats`, `conflictsPrevented` | âœ… Full data |
| **Brain metadata** | `run-metadata.json` â†’ domain, context, created, config | âœ… Full data |
| **Node/edge counts** | `state.json.gz` â†’ count arrays | âœ… Compute on export |
| **Research sources** | `outputs/research/*/sources.json` | âœ… Aggregate on export |
| **Provenance tracking** | Prefix-coded node IDs (e.g., `fa7572_123`) | âœ… In place |

### Real Example: `_MegaMerge_12_13_25`

This actual merged brain contains:
```
merge-report.json:
â”œâ”€â”€ sourceRuns: 49 runs with full metadata
â”œâ”€â”€ mergeTime: "70m 43s"
â”œâ”€â”€ mergedState: { nodes: 6282, edges: 23913, goals: 4156 }
â”œâ”€â”€ deduplication: { rate: "89.3%", removed: 52403 }
â””â”€â”€ confidence: { conflictsPrevented: 74833, domainStats: [...] }
```

### Transformation Path

```
Current Run Folder          â†’    Proposed .brain Package
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
state.json.gz               â†’    state.json.gz (copy)
run-metadata.json           â†’    manifest.json (reshape)
merge-report.json           â†’    lineage/parents.json (reshape)
merge-confidence.json       â†’    metadata/merge-quality.json (rename)
outputs/research/*/sources  â†’    metadata/sources.json (aggregate)
outputs/                    â†’    outputs/ (optional, --with-outputs)
```

### Implementation Effort (Revised)

| Feature | Effort | Notes |
|---------|--------|-------|
| `brain export` command | **1-2 days** | Transform existing data |
| `brain import` command | **1 day** | Reverse of export |
| `--preserve-outputs` in merge | **1 day** | Copy outputs folders |
| `manifest.json` generation | **Few hours** | Reshape + compute checksums |
| Brain Viewer (read-only web) | **1-2 weeks** | New UI, but uses existing data |
| Brain Cloud (registry) | **Multi-week** | New infrastructure |

### What's Actually New Work

1. **Export/Import CLI** - Packaging existing data into `.brain` format
2. **Brain Viewer** - New read-only web interface
3. **Brain Cloud** - New registry infrastructure
4. **Optional outputs preservation** - `--preserve-outputs` flag for merge

### What's NOT Needed

- âŒ New data collection during runs (already captured)
- âŒ Backward-incompatible changes to COSMO
- âŒ Migration scripts for old runs (can export anytime)
- âŒ New provenance tracking (prefix IDs already work)

---

## COSMO Product

### What COSMO Is

COSMO is an **autonomous AI research system** that:
- Runs continuous research cycles
- Spawns specialist agents (research, analysis, synthesis, code, etc.)
- Builds knowledge graphs through investigation
- Produces structured outputs (documents, code, data)
- Self-coordinates via an "Executive Ring"

### Deployment Tiers

| Tier | Target User | Deployment | Features |
|------|-------------|------------|----------|
| **COSMO Local** | Developers, Researchers | npm/Docker | Full engine, local storage |
| **COSMO Team** | Small teams (2-10) | Docker Compose | Multi-user, shared runs |
| **COSMO Enterprise** | Organizations | K8s / On-prem | SSO, audit, compliance, HA |
| **COSMO Cloud** | Everyone | Hosted SaaS | Zero setup, managed |

### COSMO Local

```bash
# Installation
npm install -g @cosmo/cli
# or
docker pull cosmo/engine:latest

# Basic usage
cosmo init my-research
cosmo run --topic "quantum computing" --depth deep

# With brain
cosmo run --brain quantum-2024 --topic "error correction"
cosmo export --output quantum-extended.brain
```

### COSMO Cloud

```bash
# Cloud usage
cosmo cloud login
cosmo cloud run --topic "climate modeling" --hours 4
cosmo cloud export --to brain-cloud
```

### Configuration

```yaml
# cosmo.yaml
version: "1.0"

research:
  topic: "quantum computing"
  depth: deep  # light, medium, deep
  mode: strict  # strict, mixed, advisory

brain:
  source: null  # or "brain-cloud://quantum-2024"
  autoExport: true
  exportPath: "./outputs/brain"

agents:
  maxConcurrent: 5
  types:
    - research
    - analysis
    - synthesis
    - code_execution
    - document_creation

api:
  openai: ${OPENAI_API_KEY}

cloud:
  publish: false  # auto-publish to Brain Cloud
  visibility: private
```

---

## Brain Platform Product

### Components

#### 1. Brain CLI

Command-line tool for local brain operations.

```bash
# Installation
npm install -g @cosmo/brain-cli

# Core commands
brain init <name>              # Create empty brain
brain export <run-dir> <name>  # Export COSMO run to brain
brain import <brain> <run-dir> # Import brain for COSMO
brain view <brain>             # Open in viewer
brain info <brain>             # Show brain metadata

# Registry operations
brain login                    # Authenticate with Brain Cloud
brain push <brain>             # Upload to registry
brain pull <name>              # Download from registry
brain search <query>           # Search registry

# Collaboration
brain fork <name> <new-name>   # Copy brain
brain merge <brain1> <brain2>  # Merge brains
brain diff <brain1> <brain2>   # Compare brains
```

#### 2. Brain Viewer

Standalone web application for exploring brains.

**Features:**
- Memory graph visualization (nodes, edges, clusters)
- Semantic search across knowledge
- Document/artifact browser
- Source/citation explorer
- Statistics dashboard
- Export tools (bibliography, findings, summaries)

**Deployment:**
```bash
# Standalone
brain-viewer ./my-research.brain

# Or serve multiple brains
brain-viewer serve ./brains/ --port 3000
```

**Architecture:**
- Single-page React/Vue application
- Works offline (loads entire brain into browser)
- No server required for single-brain viewing
- Minimal server for multi-brain / search features

#### 3. Brain Cloud (Registry)

Hosted platform for brain storage and collaboration.

**URL Structure:**
```
https://brains.cosmo.ai/
â”œâ”€â”€ /explore                    # Browse public brains
â”œâ”€â”€ /brains/{owner}/{name}      # View specific brain
â”œâ”€â”€ /brains/{owner}/{name}/merge # Merge interface
â”œâ”€â”€ /users/{username}           # User profile
â”œâ”€â”€ /organizations/{org}        # Org brains
â””â”€â”€ /api/v1/                    # REST API
```

**Features:**
- Upload/download brains
- Public and private brains
- Organizations and teams
- Forking and merging
- Search across all public brains
- Lineage visualization
- Usage analytics

#### 4. Brain API

RESTful API for programmatic access.

```
# Brains
GET    /api/v1/brains                     # List brains
GET    /api/v1/brains/{id}                # Get brain metadata
GET    /api/v1/brains/{id}/download       # Download brain archive
POST   /api/v1/brains                     # Upload brain
DELETE /api/v1/brains/{id}                # Delete brain
PATCH  /api/v1/brains/{id}                # Update metadata

# Content
GET    /api/v1/brains/{id}/nodes          # List nodes
GET    /api/v1/brains/{id}/nodes/{nodeId} # Get node
POST   /api/v1/brains/{id}/search         # Semantic search
GET    /api/v1/brains/{id}/outputs        # List outputs

# Operations
POST   /api/v1/brains/merge               # Merge brains
POST   /api/v1/brains/{id}/fork           # Fork brain
GET    /api/v1/brains/diff                # Compare brains

# Users
GET    /api/v1/users/{username}/brains    # User's brains
GET    /api/v1/orgs/{org}/brains          # Org's brains
```

### Platform Tiers

| Tier | Price | Features |
|------|-------|----------|
| **Free** | $0/mo | 5 public brains, 1GB storage, basic viewer |
| **Pro** | $20/mo | Unlimited private, 50GB, API access, advanced search |
| **Team** | $15/user/mo | Collaboration, shared workspaces, permissions |
| **Enterprise** | Custom | On-prem option, SSO, SLA, dedicated support |

---

## Integration Points

### COSMO â†’ Brain (Export)

```javascript
// In COSMO, after run completes
const brain = await cosmo.exportBrain({
  name: 'quantum-2024',
  includeOutputs: true,
  includeIndex: true
});

await brain.save('./outputs/quantum-2024.brain');
// or
await brain.push('brain-cloud://jtr/quantum-2024');
```

### Brain â†’ COSMO (Import)

```javascript
// Start COSMO with existing brain
const cosmo = new COSMO({
  brain: './brains/quantum-2024.brain',
  // or
  brain: 'brain-cloud://jtr/quantum-2024'
});

await cosmo.run({
  topic: 'quantum error correction',
  continueFrom: 'latest'  // Continue from brain's state
});
```

### COSMO Config Integration

```yaml
# cosmo.yaml
brain:
  # Load from local
  source: "./brains/foundation.brain"
  
  # Or from cloud
  source: "brain-cloud://public/science-2024"
  
  # Export settings
  autoExport: true
  exportFormat: "brain"  # brain, json, tar.gz
  exportPath: "./outputs/"
  
  # Cloud publishing
  publish:
    enabled: true
    visibility: "private"
    name: "my-research-{{date}}"
```

### Webhook Events

Brain Cloud can notify external systems:

```json
{
  "event": "brain.pushed",
  "brain": {
    "id": "brain-abc123",
    "name": "quantum-2024",
    "owner": "jtr"
  },
  "timestamp": "2024-12-24T15:45:00Z"
}
```

Events: `brain.pushed`, `brain.forked`, `brain.merged`, `brain.deleted`

---

## User Workflows

### 1. Solo Researcher

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SOLO RESEARCHER WORKFLOW                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Day 1: Start Research                                          â”‚
â”‚  â””â”€â†’ cosmo run --topic "protein folding" --depth deep           â”‚
â”‚  â””â”€â†’ [COSMO runs for 4 hours, 200 cycles]                       â”‚
â”‚  â””â”€â†’ cosmo export --output proteins-v1.brain                    â”‚
â”‚                                                                 â”‚
â”‚  Day 3: Continue Research                                       â”‚
â”‚  â””â”€â†’ cosmo run --brain proteins-v1.brain --topic "misfolding"   â”‚
â”‚  â””â”€â†’ [COSMO continues, 150 more cycles]                         â”‚
â”‚  â””â”€â†’ cosmo export --output proteins-v2.brain                    â”‚
â”‚                                                                 â”‚
â”‚  Day 5: Share Findings                                          â”‚
â”‚  â””â”€â†’ brain push proteins-v2.brain --public                      â”‚
â”‚  â””â”€â†’ [Brain available at brains.cosmo.ai/jtr/proteins-v2]       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Team Collaboration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TEAM COLLABORATION WORKFLOW                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Alice: Research Proteins                                       â”‚
â”‚  â””â”€â†’ cosmo run --topic "protein structure"                      â”‚
â”‚  â””â”€â†’ brain push proteins.brain --org acme --private             â”‚
â”‚                                                                 â”‚
â”‚  Bob: Research Drugs                                            â”‚
â”‚  â””â”€â†’ cosmo run --topic "drug binding"                           â”‚
â”‚  â””â”€â†’ brain push drugs.brain --org acme --private                â”‚
â”‚                                                                 â”‚
â”‚  Team: Merge Knowledge                                          â”‚
â”‚  â””â”€â†’ brain merge acme/proteins acme/drugs --output pharma       â”‚
â”‚  â””â”€â†’ [Resolve 5 conflicts in Brain Cloud UI]                    â”‚
â”‚  â””â”€â†’ brain push pharma.brain --org acme                         â”‚
â”‚                                                                 â”‚
â”‚  Carol: Continue Combined Research                              â”‚
â”‚  â””â”€â†’ cosmo run --brain acme/pharma --topic "drug discovery"     â”‚
â”‚  â””â”€â†’ brain push pharma-v2.brain --org acme                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Building on Public Knowledge

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PUBLIC KNOWLEDGE WORKFLOW                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Discover: Find Relevant Brain                                  â”‚
â”‚  â””â”€â†’ brain search "quantum computing"                           â”‚
â”‚  â””â”€â†’ [Found: public/quantum-foundations (4.2k nodes, 89 â­)]    â”‚
â”‚                                                                 â”‚
â”‚  Fork: Start Your Own Work                                      â”‚
â”‚  â””â”€â†’ brain fork public/quantum-foundations my-quantum           â”‚
â”‚                                                                 â”‚
â”‚  Extend: Add Your Research                                      â”‚
â”‚  â””â”€â†’ cosmo run --brain my-quantum --topic "topological qubits"  â”‚
â”‚  â””â”€â†’ brain push my-quantum --public                             â”‚
â”‚                                                                 â”‚
â”‚  Contribute: Merge Back (Optional)                              â”‚
â”‚  â””â”€â†’ brain merge-request my-quantum â†’ public/quantum-foundationsâ”‚
â”‚  â””â”€â†’ [Maintainer reviews and accepts]                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Enterprise Knowledge Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ENTERPRISE WORKFLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Central Knowledge Base                                         â”‚
â”‚  â””â”€â†’ acme-corp/company-knowledge (master brain)                 â”‚
â”‚      â”œâ”€â”€ /engineering                                           â”‚
â”‚      â”œâ”€â”€ /research                                              â”‚
â”‚      â”œâ”€â”€ /market-analysis                                       â”‚
â”‚      â””â”€â”€ /competitive-intel                                     â”‚
â”‚                                                                 â”‚
â”‚  Team Contributions                                             â”‚
â”‚  â””â”€â†’ Each team runs COSMO on their domain                       â”‚
â”‚  â””â”€â†’ Weekly merge into company-knowledge                        â”‚
â”‚  â””â”€â†’ Automated quality gates before merge                       â”‚
â”‚                                                                 â”‚
â”‚  Consumption                                                    â”‚
â”‚  â””â”€â†’ Employees query company-knowledge via API                  â”‚
â”‚  â””â”€â†’ Integrated into internal tools (Slack, Notion, etc.)       â”‚
â”‚  â””â”€â†’ Audit trail for compliance                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Business Model

### Revenue Streams

#### COSMO Revenue

| Stream | Model | Notes |
|--------|-------|-------|
| **COSMO Local** | Free / Open Core | Community growth |
| **COSMO Pro** | $50/mo | Power user features |
| **COSMO Team** | $200/mo | Multi-user, 5 seats |
| **COSMO Enterprise** | $2k+/mo | On-prem, SSO, support |
| **COSMO Cloud** | Usage-based | $0.10/cycle, $0.50/agent-hour |

#### Brain Platform Revenue

| Stream | Model | Notes |
|--------|-------|-------|
| **Free Tier** | $0 | 5 public brains, 1GB |
| **Pro** | $20/mo | Unlimited, 50GB, API |
| **Team** | $15/user/mo | Collaboration |
| **Enterprise** | Custom | On-prem, SLA |
| **Storage** | $0.10/GB/mo | Above tier limits |
| **API Calls** | $0.001/call | Above tier limits |
| **Marketplace** | 15% cut | Premium brain sales |

### Pricing Philosophy

1. **COSMO free tier** drives adoption and brain creation
2. **Brain Platform free tier** drives brain sharing
3. **Paid tiers** unlock collaboration and scale
4. **Marketplace** creates ecosystem value

---

## The Unlock: Minimum Viable Brain Package

> **This is what needs to ship to enable everything else.**

### The MVP Deliverables

| Deliverable | What It Does | Effort | Priority |
|-------------|--------------|--------|----------|
| `scripts/brain-cli.js` | export, import, info, validate | 2-3 days | **P0** |
| `.brain` spec documentation | Formal format docs | 1 day | **P0** |
| `@cosmo/brain` npm package | JS library for loading/querying brains | 3-4 days | **P0** |
| Example brains | Sample packaged brains from existing runs | Existing | **P0** |
| Brain API (local) | REST endpoints for querying a brain | 2-3 days | P1 |

### The CLI

```bash
# Export a run to .brain format
brain export Physics2 --output Physics2.brain --with-outputs

# Import a .brain into COSMO runs folder
brain import Physics2.brain --target ./runs/

# Show brain info
brain info Physics2.brain

# Validate a brain package
brain validate Physics2.brain

# Merge brains (wraps existing merge_runs.js)
brain merge Brain1.brain Brain2.brain --output Merged.brain
```

### The Library

```javascript
import { Brain } from '@cosmo/brain';

// Load a brain
const brain = await Brain.load('./Physics2.brain');

// Get metadata
console.log(brain.manifest);  // { name, created, nodes, edges, ... }

// Query nodes
const results = await brain.search('entropy');
const node = await brain.getNode('fa7572_1234');
const related = await brain.getRelated('fa7572_1234', { limit: 10 });

// Conversational query (requires embeddings)
const answer = await brain.ask('What is entropy?');

// Merge brains
const merged = await Brain.merge([brain1, brain2], {
  preserveOutputs: true,
  threshold: 0.85
});

// Save
await merged.save('./merged.brain');
```

### Why This Is The Unlock

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  COSMO Engine   â”‚
                        â”‚  (produces)     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚     .brain      â”‚â—„â”€â”€â”€â”€ THE UNLOCK
                        â”‚   (portable)    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                     â”‚                     â”‚
           â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Share     â”‚       â”‚   Build     â”‚       â”‚   Merge     â”‚
    â”‚   â”€â”€â”€â”€â”€â”€    â”‚       â”‚   â”€â”€â”€â”€â”€     â”‚       â”‚   â”€â”€â”€â”€â”€     â”‚
    â”‚ Brain Cloud â”‚       â”‚ Your App    â”‚       â”‚ Collective  â”‚
    â”‚ Marketplace â”‚       â”‚ Your Tool   â”‚       â”‚ Knowledge   â”‚
    â”‚ Public libs â”‚       â”‚ Plugins     â”‚       â”‚ BigBrain    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Once `.brain` ships, the collective builds. We don't need to build everything.**

---

## Technical Roadmap

### Phase 1: Foundation (Q1 2025)

**Goal:** Establish the brain format and local tooling

> âœ… **REVISED:** Most data already exists. This phase is packaging, not building.

| Task | Priority | Effort | Notes |
|------|----------|--------|-------|
| Finalize `.brain` specification | P0 | **2-3 days** | Mostly done in this doc |
| `brain export` command | P0 | **1-2 days** | Reshape existing data |
| `brain import` command | P0 | **1 day** | Reverse transform |
| `brain info` command | P1 | **1 day** | Read manifest |
| `--preserve-outputs` flag in merge | P1 | **1 day** | Copy outputs folders |
| Brain Viewer MVP (local, read-only) | P1 | 2 weeks | New UI |
| Documentation | P1 | 3 days | |

**Deliverables:**
- [ ] `.brain` spec v1.0 (this document)
- [ ] `scripts/brain-cli.js` (export, import, info)
- [ ] `--preserve-outputs` flag in merge_runs.js
- [ ] Brain Viewer standalone app (optional, can defer)

### Phase 2: Platform MVP (Q2 2025)

**Goal:** Launch Brain Cloud with basic registry

| Task | Priority | Effort |
|------|----------|--------|
| Brain Cloud backend (upload/download) | P0 | 4 weeks |
| User authentication | P0 | 2 weeks |
| Web UI for browsing brains | P0 | 3 weeks |
| CLI push/pull commands | P0 | 1 week |
| Public/private brain support | P1 | 1 week |
| Basic search | P1 | 2 weeks |

**Deliverables:**
- [ ] Brain Cloud beta at brains.cosmo.ai
- [ ] User accounts
- [ ] `brain push/pull` working
- [ ] Public brain discovery

### Phase 3: Collaboration (Q3 2025)

**Goal:** Enable team workflows

> âœ… **REVISED:** Merge V2 engine is DONE. Fork system exists. This phase is mostly UI.

| Task | Priority | Effort | Notes |
|------|----------|--------|-------|
| Fork workflow | P0 | 1 week | âœ… Fork system exists, need `.brain` export |
| Merge engine | ~~P0~~ | ~~4 weeks~~ | âœ… **DONE** - V2 in merge_runs.js |
| Conflict resolution UI | P1 | 3 weeks | New (V2 already prevents conflicts) |
| Organizations and teams | P0 | 3 weeks | New |
| Permissions system | P1 | 2 weeks | New |
| Brain diff visualization | P2 | 3 weeks | New |
| Lineage explorer UI | P1 | 2 weeks | Display existing merge-report.json |

**Deliverables:**
- [x] Merge engine V2 (domain-aware, conflict detection, provenance)
- [ ] Fork â†’ `.brain` export workflow
- [ ] Team workspaces
- [ ] Lineage explorer (visualize merge-report.json)

### Phase 4: Ecosystem (Q4 2025)

**Goal:** Scale and monetize

| Task | Priority | Effort |
|------|----------|--------|
| COSMO Cloud MVP | P0 | 8 weeks |
| Brain Marketplace | P1 | 4 weeks |
| API rate limiting / monetization | P0 | 2 weeks |
| Enterprise features (SSO, audit) | P1 | 4 weeks |
| Integrations (Notion, Obsidian, etc.) | P2 | 6 weeks |
| On-prem Brain Cloud option | P2 | 4 weeks |

**Deliverables:**
- [ ] COSMO Cloud GA
- [ ] Marketplace with paid brains
- [ ] Enterprise tier
- [ ] Third-party integrations

### Infrastructure Already Built âœ…

The following infrastructure already exists and forms the foundation:

| Component | Location | Status |
|-----------|----------|--------|
| **Merge V2 Engine** | `scripts/merge_runs.js` | âœ… Production |
| **Domain-adaptive thresholds** | V2 CONFIG | âœ… 10+ domains |
| **Weighted similarity** | V2 `weightedCosineSimilarity()` | âœ… Cross-domain safe |
| **Conflict detection** | V2 `detectSemanticConflict()` | âœ… Negations, antonyms |
| **Prefix-coded provenance** | V2 `getRunPrefix()` | âœ… SHA256-based |
| **Confidence reports** | `merge-confidence.json` | âœ… Full metrics |
| **Lineage tracking** | `merge-report.json` | âœ… Full source history |
| **Fork system** | `src/core/trajectory-fork.js` | âœ… Works |
| **State persistence** | `state.json.gz` | âœ… 24 subsystems |
| **Run metadata** | `run-metadata.json` | âœ… All launcher config |
| **Research sources** | `outputs/research/*/sources.json` | âœ… Per-agent |
| **Run scanner** | `scripts/scan_runs.js` | âœ… Analysis tool |

**V2 Merge Features (from `MERGE_V2_UPGRADE_SUMMARY.md`):**
1. âœ… Domain-Adaptive Threshold Logic
2. âœ… Domain-Weighted Similarity  
3. âœ… Node-Level Merge Heuristics
4. âœ… Cross-Run Conflict Detection
5. âœ… Fragmentation-Aware Merge Ordering
6. âœ… Smarter ID Remapping (prefix-coded)
7. âœ… Post-Merge Confidence Heatmap

---

## Competitive Moat

### Network Effects

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLYWHEEL EFFECT                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   More COSMO Users                                              â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚   More Brains Created â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚         â”‚                               â”‚                       â”‚
â”‚         â–¼                               â–¼                       â”‚
â”‚   Brain Cloud More Valuable    Better Merged Brains             â”‚
â”‚         â”‚                               â”‚                       â”‚
â”‚         â–¼                               â–¼                       â”‚
â”‚   More Users Join â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ COSMO More Valuable              â”‚
â”‚         â”‚                                                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Defensibility Layers

| Layer | Defense |
|-------|---------|
| **Format** | `.brain` becomes the standard (open spec helps adoption) |
| **Data** | Collective knowledge compounds (can't be replicated) |
| **Tooling** | Best-in-class CLI/viewer/cloud |
| **Community** | Researchers, teams, organizations |
| **Switching Cost** | Research history, team workflows |

### Competitive Landscape

| Competitor | What They Do | Our Differentiation |
|------------|--------------|---------------------|
| Notion AI | Doc assistant | We build knowledge, not assist |
| Obsidian | Local notes | We generate knowledge autonomously |
| Mem.ai | AI memory | We have structured graphs + merge |
| Semantic Scholar | Paper search | We synthesize, not just search |
| Elicit | Research assistant | We run autonomously for hours/days |

---

## Open Questions

### Technical

1. **Brain size limits?** How do we handle 100GB+ brains efficiently?
2. **Incremental sync?** Can we push/pull deltas instead of full brains?
3. **Real-time collaboration?** Multiple COSMO instances on same brain?
4. **Embedding compatibility?** What if embedding models change?

### Product

1. **Free tier limits?** What's the right balance for adoption vs. cost?
2. **Marketplace curation?** How do we ensure brain quality?
3. **Licensing?** What licenses make sense for shared brains?
4. **Attribution?** How do we track credit across merges?

### Business

1. **Open source strategy?** What's open vs. proprietary?
2. **Enterprise sales?** Build sales team or self-serve?
3. **Pricing experiments?** How do we find optimal pricing?
4. **Partnerships?** Academic institutions, research labs?

---

## Appendix A: CLI Reference

```bash
# Brain CLI Commands

# Initialization
brain init <name>                    # Create new empty brain
brain export <cosmo-run> <brain>     # Export COSMO run to brain
brain import <brain> <cosmo-run>     # Import brain for COSMO

# Information
brain info <brain>                   # Show brain metadata
brain stats <brain>                  # Detailed statistics
brain validate <brain>               # Validate brain format

# Local Operations
brain view <brain>                   # Open in viewer
brain search <brain> <query>         # Search within brain
brain export-bib <brain>             # Export bibliography

# Registry Operations
brain login                          # Authenticate
brain logout                         # Clear credentials
brain push <brain> [--name <name>]   # Upload to registry
brain pull <name> [--output <dir>]   # Download from registry
brain list [--user <user>]           # List brains

# Collaboration
brain fork <name> <new-name>         # Fork a brain
brain merge <brain1> <brain2> [--output <name>]  # Merge brains
brain diff <brain1> <brain2>         # Compare brains

# Options (apply to most commands)
--verbose, -v                        # Verbose output
--quiet, -q                          # Minimal output
--json                               # JSON output
--config <file>                      # Config file
```

---

## Appendix B: API Reference

See separate document: `docs/BRAIN_API_REFERENCE.md` (to be created)

---

## Appendix C: Glossary

| Term | Definition |
|------|------------|
| **Brain** | Packaged AI knowledge graph with artifacts |
| **Node** | Single piece of knowledge in the graph |
| **Edge** | Relationship between nodes |
| **Cluster** | Group of related nodes |
| **COSMO** | Autonomous research engine |
| **Brain Cloud** | Hosted platform for brain sharing |
| **Brain Viewer** | Tool for exploring brain contents |
| **Merge** | Combine multiple brains into one |
| **Fork** | Copy a brain to start independent work |
| **Lineage** | History of brain derivation/merging |

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2024-12-24 | JTR + Claude | Initial vision document |
| 1.1 | 2024-12-24 | JTR + Claude | **CORRECTED**: Audited against actual codebase. Clearly marked ACTUAL vs PROPOSED sections. Fixed hallucinated schemas (node metadata, sources, lineage). Added actual state.json.gz structure from real runs. |

---

*This is a living document. Update as the vision evolves.*

**Validation reminder:** Before adding to this document, verify against the actual codebase. 
Run `gunzip -c runs/{run}/state.json.gz | python3 -c "import json,sys; print(json.load(sys.stdin).keys())"` 
to check actual structure.

