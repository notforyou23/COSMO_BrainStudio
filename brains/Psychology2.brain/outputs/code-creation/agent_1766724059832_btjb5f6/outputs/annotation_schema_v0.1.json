{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/task-taxonomy/annotation_schema_v0.1.json",
  "title": "Task Taxonomy Annotation Schema v0.1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "annotation_id",
    "schema_version",
    "item",
    "task",
    "content",
    "annotation"
  ],
  "properties": {
    "annotation_id": {
      "type": "string",
      "minLength": 1,
      "maxLength": 128,
      "description": "Unique identifier for this annotation record (stable across re-exports)."
    },
    "schema_version": {
      "type": "string",
      "const": "0.1",
      "description": "Schema version for this annotation format."
    },
    "codebook_version": {
      "type": "string",
      "minLength": 1,
      "maxLength": 64,
      "description": "Version identifier for the taxonomy codebook used (e.g., '0.1')."
    },
    "item": {
      "type": "object",
      "additionalProperties": false,
      "required": ["item_id"],
      "properties": {
        "item_id": {
          "type": "string",
          "minLength": 1,
          "maxLength": 128,
          "description": "Unique identifier of the underlying data item being annotated."
        },
        "source": {
          "type": "string",
          "minLength": 1,
          "maxLength": 256,
          "description": "Optional provenance label (dataset name, URL, filename, etc.)."
        },
        "split": {
          "type": "string",
          "enum": ["train", "dev", "test", "unspecified"],
          "default": "unspecified",
          "description": "Optional split tag for downstream modeling."
        }
      }
    },
    "task": {
      "type": "object",
      "additionalProperties": false,
      "required": ["category", "label"],
      "properties": {
        "category": {
          "type": "string",
          "minLength": 1,
          "maxLength": 64,
          "pattern": "^[a-z0-9_]+$",
          "description": "Top-level task category key; must match the taxonomy codebook."
        },
        "label": {
          "type": "string",
          "minLength": 1,
          "maxLength": 64,
          "pattern": "^[a-z0-9_]+$",
          "description": "Task label key within the category; must match the taxonomy codebook."
        },
        "variant": {
          "type": "string",
          "minLength": 1,
          "maxLength": 64,
          "pattern": "^[a-z0-9_]+$",
          "description": "Optional finer-grained variant key as defined by the codebook."
        }
      }
    },
    "content": {
      "type": "object",
      "additionalProperties": false,
      "required": ["input"],
      "properties": {
        "input": {
          "description": "Primary input content for the task (string or structured).",
          "oneOf": [
            { "type": "string", "minLength": 0, "maxLength": 200000 },
            { "type": "object" },
            { "type": "array" }
          ]
        },
        "output": {
          "description": "Optional reference/expected output (string or structured).",
          "oneOf": [
            { "type": "string", "minLength": 0, "maxLength": 200000 },
            { "type": "object" },
            { "type": "array" }
          ]
        },
        "context": {
          "description": "Optional auxiliary context (metadata, retrieved passages, etc.).",
          "oneOf": [
            { "type": "object" },
            { "type": "array" }
          ]
        },
        "language": {
          "type": "string",
          "minLength": 2,
          "maxLength": 16,
          "default": "und",
          "description": "BCP-47 language tag (e.g., 'en'); use 'und' if unknown."
        }
      }
    },
    "annotation": {
      "type": "object",
      "additionalProperties": false,
      "required": ["decision"],
      "properties": {
        "decision": {
          "type": "string",
          "enum": ["include", "exclude"],
          "description": "Whether the item should be included under the selected task label."
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Optional annotator confidence from 0 to 1."
        },
        "rationale": {
          "type": "string",
          "maxLength": 20000,
          "description": "Optional free-text justification."
        },
        "tags": {
          "type": "array",
          "maxItems": 64,
          "items": { "type": "string", "minLength": 1, "maxLength": 64, "pattern": "^[a-z0-9_\-]+$" },
          "uniqueItems": true,
          "description": "Optional lightweight tags for analysis (not taxonomy labels)."
        },
        "constraints": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "requires_codebook_match": {
              "type": "boolean",
              "default": true,
              "description": "If true, validator must enforce (category,label,variant) membership in codebook."
            }
          }
        }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "annotator_id": { "type": "string", "minLength": 1, "maxLength": 128 },
        "timestamp_utc": {
          "type": "string",
          "format": "date-time",
          "description": "RFC 3339 timestamp (UTC recommended)."
        },
        "tool": { "type": "string", "minLength": 1, "maxLength": 128 }
      }
    }
  }
}
