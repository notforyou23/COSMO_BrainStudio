version: 1
runner:
  name: canonical
  backend: docker
  docker:
    image: "python:3.11-slim"
    pull_policy: if_not_present
    init: true
    network_mode: bridge
    user: "0:0"
    workdir: "/workspace"
    command:
      - "python"
      - "-m"
      - "runner.entrypoint"
    mounts:
      - type: bind
        source: "."
        target: "/workspace"
        read_only: false
      - type: bind
        source: "runtime"
        target: "/workspace/runtime"
        read_only: false
    environment:
      PYTHONUNBUFFERED: "1"
      PIP_DISABLE_PIP_VERSION_CHECK: "1"
      PIP_NO_CACHE_DIR: "1"
    timeouts:
      start_seconds: 120
      run_seconds: 3600
      stop_seconds: 30
    resources:
      cpus: null
      memory: null
  artifacts:
    root_dir: "runtime/_build/logs"
    policy:
      always_write: true
      atomic_writes: true
    files:
      run_log: "run.log"
      env_snapshot: "env.json"
      runner_config_copy: "runner_config.yaml"
      run_summary: "run_summary.json"
      container_lost_marker: "container_lost.json"
  container_lost:
    detect: true
    record_timestamps: true
    reasons:
      - container_disappeared
      - docker_api_error
      - stream_ended_unexpectedly
  summary_schema:
    format: "json"
    stable_fields:
      - run_id
      - started_at
      - finished_at
      - exit_code
      - status
      - container_lost
      - container_lost_at
      - image
      - command
      - artifacts_dir
      - log_path
      - env_snapshot_path
      - runner_config_path
