{
  "content": "Implemented `src/cosmo_contracts/schema.py` defining compact dataclass models plus Draft 2020-12 JSON Schemas for benchmark contracts (metadata, reference algorithm/pseudocode, invariants, tolerance policy, canonical test vectors) and implementation compliance reports, with a lightweight `validate_against_schema` helper (uses `jsonschema` if available, otherwise minimal structural checks).",
  "reasoning": "",
  "responseId": "resp_07ee01c7fd6d0884006949a1fade90819497ccc96845e786b7",
  "model": "gpt-5.2-2025-12-11",
  "usage": {
    "input_tokens": 3895,
    "input_tokens_details": {
      "cached_tokens": 0
    },
    "output_tokens": 2412,
    "output_tokens_details": {
      "reasoning_tokens": 304
    },
    "total_tokens": 6307
  },
  "hadError": false,
  "errorType": null,
  "webSearchSources": [],
  "citations": [],
  "output": [
    {
      "id": "rs_07ee01c7fd6d0884006949a1fbb05c8194b97b1a0e2cc6cf43",
      "type": "reasoning",
      "summary": []
    },
    {
      "id": "ci_07ee01c7fd6d0884006949a2012b688194b00e31e14f37247a",
      "type": "code_interpreter_call",
      "status": "completed",
      "code": "from pathlib import Path\nimport json\n\ntarget_path = Path('/mnt/data').joinpath('src/cosmo_contracts/schema.py')\ntarget_path.parent.mkdir(parents=True, exist_ok=True)\n\nchunks = []\n\nchunks.append(\"\"\"\n\\\"\\\"\\\"Contract data model + JSON Schemas for COSMO benchmark contracts.\n\nA contract is attached per v0.1 benchmark and is used to:\n- declare required metadata\n- provide a reference algorithm/pseudocode\n- state output invariants\n- define tolerance policy for numeric comparisons\n- ship canonical test vectors\n\\\"\\\"\\\"\n\nfrom __future__ import annotations\n\nfrom dataclasses import dataclass, field, asdict\nfrom typing import Any, Dict, List, Optional, Tuple\n\"\"\")\n\nchunks.append(\"\"\"\n# JSON Schema (draft 2020-12) for a benchmark contract document.\nCONTRACT_SCHEMA: Dict[str, Any] = {\n    \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n    \"$id\": \"https://cosmo-benchmarks.dev/schemas/contract.schema.json\",\n    \"title\": \"COSMO Benchmark Contract\",\n    \"type\": \"object\",\n    \"required\": [\"metadata\", \"reference\", \"invariants\", \"tolerance_policy\", \"test_vectors\"],\n    \"additionalProperties\": False,\n    \"properties\": {\n        \"metadata\": {\n            \"type\": \"object\",\n            \"required\": [\"benchmark_id\", \"benchmark_version\", \"title\", \"description\"],\n            \"additionalProperties\": False,\n            \"properties\": {\n                \"benchmark_id\": {\"type\": \"string\", \"minLength\": 1},\n                \"benchmark_version\": {\"type\": \"string\", \"minLength\": 1},\n                \"title\": {\"type\": \"string\", \"minLength\": 1},\n                \"description\": {\"type\": \"string\", \"minLength\": 1},\n                \"tags\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"default\": []},\n                \"authors\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}, \"default\": []},\n                \"license\": {\"type\": \"string\"},\n                \"source\": {\"type\": \"string\", \"description\": \"Citation / URL / paper reference.\"},\n            },\n        },\n        \"reference\": {\n            \"type\": \"object\",\n            \"required\": [\"algorithm\", \"pseudocode\"],\n            \"additionalProperties\": False,\n            \"properties\": {\n                \"algorithm\": {\"type\": \"string\", \"minLength\": 1},\n                \"pseudocode\": {\"type\": \"string\", \"minLength\": 1},\n                \"notes\": {\"type\": \"string\"},\n            },\n        },\n        \"invariants\": {\n            \"type\": \"array\",\n            \"minItems\": 1,\n            \"items\": {\n                \"type\": \"object\",\n                \"required\": [\"name\", \"statement\"],\n                \"additionalProperties\": False,\n                \"properties\": {\n                    \"name\": {\"type\": \"string\", \"minLength\": 1},\n                    \"statement\": {\"type\": \"string\", \"minLength\": 1},\n                    \"scope\": {\"type\": \"string\", \"default\": \"output\"},\n                    \"severity\": {\"type\": \"string\", \"enum\": [\"must\", \"should\"], \"default\": \"must\"},\n                },\n            },\n        },\n        \"tolerance_policy\": {\n            \"type\": \"object\",\n            \"required\": [\"mode\"],\n            \"additionalProperties\": False,\n            \"properties\": {\n                \"mode\": {\"type\": \"string\", \"enum\": [\"exact\", \"absolute\", \"relative\", \"abs+rel\"]},\n                \"atol\": {\"type\": \"number\", \"minimum\": 0, \"default\": 0.0},\n                \"rtol\": {\"type\": \"number\", \"minimum\": 0, \"default\": 0.0},\n                \"nan_equal\": {\"type\": \"boolean\", \"default\": False},\n                \"explain\": {\"type\": \"string\", \"description\": \"Human-readable policy rationale.\"},\n            },\n            \"allOf\": [\n                {\n                    \"if\": {\"properties\": {\"mode\": {\"const\": \"exact\"}}},\n                    \"then\": {\"properties\": {\"atol\": {\"const\": 0.0}, \"rtol\": {\"const\": 0.0}}},\n                },\n                {\n                    \"if\": {\"properties\": {\"mode\": {\"enum\": [\"absolute\", \"abs+rel\"]}}},\n                    \"then\": {\"required\": [\"atol\"]},\n                },\n                {\n                    \"if\": {\"properties\": {\"mode\": {\"enum\": [\"relative\", \"abs+rel\"]}}},\n                    \"then\": {\"required\": [\"rtol\"]},\n                },\n            ],\n        },\n        \"test_vectors\": {\n            \"type\": \"array\",\n            \"minItems\": 1,\n            \"items\": {\n                \"type\": \"object\",\n                \"required\": [\"id\", \"inputs\", \"expected\"],\n                \"additionalProperties\": False,\n                \"properties\": {\n                    \"id\": {\"type\": \"string\", \"minLength\": 1},\n                    \"inputs\": {\"type\": \"object\"},\n                    \"expected\": {\"type\": \"object\"},\n                    \"notes\": {\"type\": \"string\"},\n                },\n            },\n        },\n    },\n}\n\"\"\")\n\nchunks.append(\"\"\"\n# JSON Schema for a contributed implementation's compliance report.\nCOMPLIANCE_REPORT_SCHEMA: Dict[str, Any] = {\n    \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n    \"$id\": \"https://cosmo-benchmarks.dev/schemas/compliance_report.schema.json\",\n    \"title\": \"COSMO Contract Compliance Report\",\n    \"type\": \"object\",\n    \"required\": [\"benchmark_id\", \"benchmark_version\", \"implementation_id\", \"passed\", \"results\"],\n    \"additionalProperties\": False,\n    \"properties\": {\n        \"benchmark_id\": {\"type\": \"string\", \"minLength\": 1},\n        \"benchmark_version\": {\"type\": \"string\", \"minLength\": 1},\n        \"implementation_id\": {\"type\": \"string\", \"minLength\": 1},\n        \"passed\": {\"type\": \"boolean\"},\n        \"summary\": {\"type\": \"string\"},\n        \"results\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"required\": [\"test_vector_id\", \"passed\"],\n                \"additionalProperties\": False,\n                \"properties\": {\n                    \"test_vector_id\": {\"type\": \"string\", \"minLength\": 1},\n                    \"passed\": {\"type\": \"boolean\"},\n                    \"diagnostics\": {\"type\": \"object\"},\n                },\n            },\n        },\n    },\n}\n\"\"\")\n\nchunks.append(\"\"\"\n@dataclass(frozen=True)\nclass Invariant:\n    name: str\n    statement: str\n    scope: str = \"output\"\n    severity: str = \"must\"\n\n\n@dataclass(frozen=True)\nclass TolerancePolicy:\n    mode: str  # exact|absolute|relative|abs+rel\n    atol: float = 0.0\n    rtol: float = 0.0\n    nan_equal: bool = False\n    explain: str = \"\"\n\n\n@dataclass(frozen=True)\nclass TestVector:\n    id: str\n    inputs: Dict[str, Any]\n    expected: Dict[str, Any]\n    notes: str = \"\"\n\n\n@dataclass(frozen=True)\nclass Contract:\n    metadata: Dict[str, Any]\n    reference: Dict[str, Any]\n    invariants: List[Invariant]\n    tolerance_policy: TolerancePolicy\n    test_vectors: List[TestVector] = field(default_factory=list)\n\n    def to_dict(self) -> Dict[str, Any]:\n        d = asdict(self)\n        d[\"invariants\"] = [asdict(x) for x in self.invariants]\n        d[\"tolerance_policy\"] = asdict(self.tolerance_policy)\n        d[\"test_vectors\"] = [asdict(x) for x in self.test_vectors]\n        return d\n\"\"\")\n\nchunks.append(\"\"\"\ndef validate_against_schema(obj: Dict[str, Any], schema: Dict[str, Any]) -> Tuple[bool, List[str]]:\n    \\\"\\\"\\\"Validate with jsonschema if available; otherwise perform minimal checks.\\\"\\\"\\\"\n    try:\n        import jsonschema  # type: ignore\n        try:\n            jsonschema.validate(instance=obj, schema=schema)\n            return True, []\n        except Exception as e:  # jsonschema.ValidationError or SchemaError\n            return False, [str(e)]\n    except Exception:\n        # Minimal structural validation (keeps this package dependency-light).\n        missing = [k for k in schema.get(\"required\", []) if k not in obj]\n        if missing:\n            return False, [f\"missing required keys: {missing}\"]\n        if schema.get(\"additionalProperties\") is False:\n            allowed = set(schema.get(\"properties\", {}).keys())\n            extra = sorted([k for k in obj.keys() if k not in allowed])\n            if extra:\n                return False, [f\"unexpected keys: {extra}\"]\n        return True, []\n\n\n__all__ = [\n    \"CONTRACT_SCHEMA\",\n    \"COMPLIANCE_REPORT_SCHEMA\",\n    \"Contract\",\n    \"Invariant\",\n    \"TolerancePolicy\",\n    \"TestVector\",\n    \"validate_against_schema\",\n]\n\"\"\")\n\nfinal_text = '\\n'.join(block.strip('\\n') for block in chunks).strip() + '\\n'\ntarget_path.write_text(final_text, encoding='utf-8')\n\nprint('FILE_WRITTEN:src/cosmo_contracts/schema.py')\nprint('DIR_STATE:' + json.dumps(sorted(str(p.relative_to(Path(\"/mnt/data\"))) for p in target_path.parent.glob('*') if p.is_file())))\n",
      "container_id": "cntr_6949a1d5445881908092d2723527a8b207f782e9910e8fd5",
      "outputs": [
        {
          "type": "logs",
          "logs": "FILE_WRITTEN:src/cosmo_contracts/schema.py\nDIR_STATE:[\"src/cosmo_contracts/__init__.py\", \"src/cosmo_contracts/schema.py\"]\n"
        }
      ]
    },
    {
      "id": "msg_07ee01c7fd6d0884006949a2151c6c8194aa3756c01220efe6",
      "type": "message",
      "status": "completed",
      "content": [
        {
          "type": "output_text",
          "annotations": [],
          "logprobs": [],
          "text": "Implemented `src/cosmo_contracts/schema.py` defining compact dataclass models plus Draft 2020-12 JSON Schemas for benchmark contracts (metadata, reference algorithm/pseudocode, invariants, tolerance policy, canonical test vectors) and implementation compliance reports, with a lightweight `validate_against_schema` helper (uses `jsonschema` if available, otherwise minimal structural checks)."
        }
      ],
      "role": "assistant"
    }
  ],
  "codeResults": []
}