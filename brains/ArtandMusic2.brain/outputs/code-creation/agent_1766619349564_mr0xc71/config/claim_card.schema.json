{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/claim_card.schema.json",
  "title": "Claim Card",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "card",
    "claim",
    "source",
    "provenance",
    "correction_history"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0"
    },
    "card": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "card_id",
        "title",
        "created_at",
        "updated_at",
        "status",
        "authors"
      ],
      "properties": {
        "card_id": {
          "type": "string",
          "pattern": "^[A-Za-z0-9._-]{6,128}$"
        },
        "title": {
          "type": "string",
          "minLength": 3
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": [
            "draft",
            "active",
            "deprecated",
            "superseded"
          ]
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "authors": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "name"
            ],
            "properties": {
              "name": {
                "type": "string",
                "minLength": 1
              },
              "affiliation": {
                "type": "string"
              },
              "orcid": {
                "type": "string",
                "pattern": "^(\\d{4}-){3}\\d{3}[\\dX]$"
              },
              "email": {
                "type": "string",
                "format": "email"
              }
            }
          }
        }
      }
    },
    "claim": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "claim_id",
        "verbatim",
        "normalized",
        "claim_type"
      ],
      "properties": {
        "claim_id": {
          "type": "string",
          "pattern": "^[A-Za-z0-9._-]{6,128}$"
        },
        "claim_type": {
          "type": "string",
          "enum": [
            "descriptive",
            "causal",
            "predictive",
            "normative",
            "other"
          ]
        },
        "verbatim": {
          "type": "string",
          "minLength": 5
        },
        "normalized": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "subject",
            "predicate",
            "object"
          ],
          "properties": {
            "subject": {
              "type": "string",
              "minLength": 1
            },
            "predicate": {
              "type": "string",
              "minLength": 1
            },
            "object": {
              "type": "string",
              "minLength": 1
            },
            "conditions": {
              "type": "string"
            },
            "quantifiers": {
              "type": "string"
            }
          }
        },
        "scope": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "population": {
              "type": "string"
            },
            "geography": {
              "type": "string"
            },
            "timeframe": {
              "type": "string"
            },
            "assumptions": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            }
          }
        },
        "confidence": {
          "type": "string",
          "enum": [
            "low",
            "medium",
            "high",
            "unknown"
          ],
          "default": "unknown"
        }
      }
    },
    "source": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "source_type",
        "citation",
        "retrieved_at"
      ],
      "properties": {
        "source_type": {
          "type": "string",
          "enum": [
            "paper",
            "web",
            "book",
            "dataset",
            "report",
            "interview",
            "other"
          ]
        },
        "citation": {
          "type": "string",
          "minLength": 3
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "doi": {
          "type": "string"
        },
        "isbn": {
          "type": "string"
        },
        "retrieved_at": {
          "type": "string",
          "format": "date-time"
        },
        "version_label": {
          "type": "string"
        },
        "version_date": {
          "type": "string",
          "format": "date"
        },
        "page_or_section": {
          "type": "string"
        },
        "quote": {
          "type": "string"
        },
        "license": {
          "type": "string"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "source_type": {
                "const": "web"
              }
            },
            "required": [
              "source_type"
            ]
          },
          "then": {
            "required": [
              "url"
            ]
          }
        }
      ]
    },
    "evidence": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "supporting_snippets": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "counterevidence": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "versioning": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "current",
        "scheme",
        "history"
      ],
      "properties": {
        "scheme": {
          "type": "string",
          "enum": [
            "semver",
            "date",
            "custom"
          ]
        },
        "current": {
          "type": "string",
          "minLength": 1
        },
        "previous": {
          "type": [
            "string",
            "null"
          ]
        },
        "history": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "version",
              "released_at"
            ],
            "properties": {
              "version": {
                "type": "string",
                "minLength": 1
              },
              "released_at": {
                "type": "string",
                "format": "date-time"
              },
              "summary": {
                "type": "string"
              }
            }
          }
        },
        "ambiguity_flags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "missing_version",
              "conflicting_version",
              "unknown_edition",
              "undated_source"
            ]
          },
          "default": []
        }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "created_by",
        "created_via",
        "inputs"
      ],
      "properties": {
        "created_by": {
          "type": "string",
          "minLength": 1
        },
        "created_via": {
          "type": "string",
          "enum": [
            "manual",
            "llm",
            "hybrid",
            "imported"
          ]
        },
        "tooling": {
          "type": "object",
          "additionalProperties": true
        },
        "inputs": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "type",
              "ref"
            ],
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "document",
                  "url",
                  "dataset",
                  "note",
                  "other"
                ]
              },
              "ref": {
                "type": "string",
                "minLength": 1
              },
              "hash": {
                "type": "string"
              },
              "retrieved_at": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        },
        "extraction": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "method": {
              "type": "string",
              "enum": [
                "quote",
                "paraphrase",
                "inference",
                "unknown"
              ],
              "default": "unknown"
            },
            "rationale": {
              "type": "string"
            },
            "trace": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            }
          }
        }
      }
    },
    "correction_history": {
      "type": "array",
      "description": "Append-only log of corrections; empty array indicates no corrections yet.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "event_id",
          "timestamp",
          "event_type",
          "description",
          "actor",
          "changes"
        ],
        "properties": {
          "event_id": {
            "type": "string",
            "pattern": "^[A-Za-z0-9._-]{6,128}$"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "event_type": {
            "type": "string",
            "enum": [
              "created",
              "metadata_fix",
              "source_fix",
              "claim_fix",
              "version_fix",
              "retraction",
              "other"
            ]
          },
          "description": {
            "type": "string",
            "minLength": 3
          },
          "actor": {
            "type": "string",
            "minLength": 1
          },
          "changes": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "changed_fields"
            ],
            "properties": {
              "changed_fields": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "string"
                }
              },
              "prior_values": {
                "type": "object",
                "additionalProperties": true
              },
              "new_values": {
                "type": "object",
                "additionalProperties": true
              },
              "prior_card_version": {
                "type": [
                  "string",
                  "null"
                ]
              },
              "new_card_version": {
                "type": [
                  "string",
                  "null"
                ]
              }
            }
          },
          "links": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uri"
            },
            "default": []
          }
        }
      }
    },
    "validation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "last_validated_at": {
          "type": "string",
          "format": "date-time"
        },
        "validator_version": {
          "type": "string"
        },
        "failure_modes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        }
      }
    }
  }
}
