{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/schemas/CASE_STUDY.schema.json",
  "title": "Case Study Record",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "id",
    "slug",
    "title",
    "summary",
    "created_at",
    "updated_at",
    "status",
    "authors",
    "tags",
    "domains",
    "content",
    "artifacts",
    "provenance"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^1\\.0\\.0$"
    },
    "id": {
      "type": "string",
      "description": "Stable identifier (e.g., UUID, ULID, or org-specific).",
      "minLength": 8,
      "maxLength": 128
    },
    "slug": {
      "type": "string",
      "description": "Directory-friendly slug used in runtime/outputs/case_studies/<slug>/",
      "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$",
      "minLength": 3,
      "maxLength": 80
    },
    "title": {
      "type": "string",
      "minLength": 3,
      "maxLength": 200
    },
    "summary": {
      "type": "string",
      "description": "One-paragraph executive summary.",
      "minLength": 20,
      "maxLength": 3000
    },
    "status": {
      "type": "string",
      "enum": ["draft", "review", "published", "archived"]
    },
    "created_at": { "type": "string", "format": "date-time" },
    "updated_at": { "type": "string", "format": "date-time" },
    "language": {
      "type": "string",
      "default": "en",
      "pattern": "^[a-z]{2}(?:-[A-Z]{2})?$"
    },
    "authors": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "role"],
        "properties": {
          "name": { "type": "string", "minLength": 2, "maxLength": 120 },
          "role": { "type": "string", "minLength": 2, "maxLength": 80 },
          "affiliation": { "type": "string", "maxLength": 160 },
          "orcid": { "type": "string", "pattern": "^(?:\\d{4}-){3}\\d{3}[\\dX]$" },
          "email": { "type": "string", "format": "email" }
        }
      }
    },
    "tags": {
      "type": "array",
      "items": { "type": "string", "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$" },
      "uniqueItems": true,
      "default": []
    },
    "domains": {
      "type": "array",
      "description": "High-level domains (e.g., education, healthcare, policy).",
      "minItems": 1,
      "items": { "type": "string", "minLength": 2, "maxLength": 80 },
      "uniqueItems": true
    },
    "content": {
      "type": "object",
      "additionalProperties": false,
      "required": ["context", "problem", "stakeholders", "approach", "evidence", "outcomes"],
      "properties": {
        "context": { "type": "string", "minLength": 20, "maxLength": 20000 },
        "problem": {
          "type": "object",
          "additionalProperties": false,
          "required": ["statement"],
          "properties": {
            "statement": { "type": "string", "minLength": 20, "maxLength": 8000 },
            "constraints": { "type": "array", "items": { "type": "string", "minLength": 3, "maxLength": 400 }, "default": [] },
            "success_criteria": { "type": "array", "items": { "type": "string", "minLength": 3, "maxLength": 400 }, "default": [] }
          }
        },
        "stakeholders": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "type"],
            "properties": {
              "name": { "type": "string", "minLength": 2, "maxLength": 120 },
              "type": { "type": "string", "enum": ["user", "customer", "operator", "decision_maker", "community", "other"] },
              "notes": { "type": "string", "maxLength": 2000 }
            }
          },
          "default": []
        },
        "approach": {
          "type": "object",
          "additionalProperties": false,
          "required": ["summary", "steps"],
          "properties": {
            "summary": { "type": "string", "minLength": 20, "maxLength": 12000 },
            "steps": { "type": "array", "minItems": 1, "items": { "type": "string", "minLength": 5, "maxLength": 1000 } },
            "tools": { "type": "array", "items": { "type": "string", "minLength": 2, "maxLength": 120 }, "default": [] }
          }
        },
        "evidence": {
          "type": "object",
          "additionalProperties": false,
          "required": ["claims"],
          "properties": {
            "claims": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["claim", "support_level"],
                "properties": {
                  "claim": { "type": "string", "minLength": 10, "maxLength": 2000 },
                  "support_level": { "type": "string", "enum": ["anecdotal", "observational", "measured", "peer_reviewed"] },
                  "metrics": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "additionalProperties": false,
                      "required": ["name"],
                      "properties": {
                        "name": { "type": "string", "minLength": 2, "maxLength": 80 },
                        "value": {},
                        "unit": { "type": "string", "maxLength": 40 },
                        "notes": { "type": "string", "maxLength": 1000 }
                      }
                    },
                    "default": []
                  },
                  "citations": {
                    "type": "array",
                    "items": { "type": "string", "minLength": 1, "maxLength": 80 },
                    "description": "BibTeX citation keys in sources.bib",
                    "default": []
                  }
                }
              }
            },
            "data_sources": { "type": "array", "items": { "type": "string", "minLength": 3, "maxLength": 400 }, "default": [] }
          }
        },
        "outcomes": {
          "type": "object",
          "additionalProperties": false,
          "required": ["summary"],
          "properties": {
            "summary": { "type": "string", "minLength": 20, "maxLength": 12000 },
            "benefits": { "type": "array", "items": { "type": "string", "minLength": 3, "maxLength": 400 }, "default": [] },
            "risks": { "type": "array", "items": { "type": "string", "minLength": 3, "maxLength": 400 }, "default": [] },
            "limitations": { "type": "array", "items": { "type": "string", "minLength": 3, "maxLength": 800 }, "default": [] },
            "next_steps": { "type": "array", "items": { "type": "string", "minLength": 3, "maxLength": 400 }, "default": [] }
          }
        }
      }
    },
    "artifacts": {
      "type": "object",
      "additionalProperties": false,
      "required": ["case_study_json", "sources_bib", "rights_md"],
      "properties": {
        "case_study_json": { "type": "string", "const": "case_study.json" },
        "sources_bib": { "type": "string", "const": "sources.bib" },
        "rights_md": { "type": "string", "const": "rights.md" },
        "attachments": { "type": "array", "items": { "type": "string", "minLength": 1, "maxLength": 200 }, "default": [] }
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": ["created_by", "inputs"],
      "properties": {
        "created_by": { "type": "string", "minLength": 2, "maxLength": 120 },
        "inputs": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["type", "ref"],
            "properties": {
              "type": { "type": "string", "enum": ["url", "file", "dataset", "interview", "other"] },
              "ref": { "type": "string", "minLength": 1, "maxLength": 1000 },
              "notes": { "type": "string", "maxLength": 2000 }
            }
          },
          "default": []
        },
        "license": { "type": "string", "maxLength": 200 },
        "reviewed_by": { "type": "array", "items": { "type": "string", "minLength": 2, "maxLength": 120 }, "default": [] }
      }
    }
  }
}
