{
  "content": "FILE_EXPORT:{\"path\":\"src/refactor_modularize/refactor.py\",\"size\":6285,\"encoding\":\"base64\",\"sha256\":\"c7abc11f6f76e64d1d708b9360a15e697cb0214fb54b6792de9ce79ce85b5bd8\",\"content\":\"IiIiQ29yZSByZWZhY3RvcmluZyArIG1vZHVsYXJpemF0aW9uIGxvZ2ljLgoKVGhpcyBtb2R1bGUgYW5hbHl6ZXMgaW5wdXQgc291cmNlIHRleHRzIChwcmltYXJpbHkgUHl0aG9uKSBhbmQgZW1pdHMgc3RydWN0dXJlZAoiYXJ0aWZhY3RzIiB0aGF0IGNhbiBiZSByZS11c2VkIGJ5IGV4cG9ydCBoZWxwZXJzIChlLmcuLCB3cml0dGVuIGFzIG1vZHVsZXMpLgpUaGUgaGV1cmlzdGljcyBhcmUgaW50ZW50aW9uYWxseSBsaWdodHdlaWdodCBhbmQgZGVwZW5kZW5jeS1mcmVlLgoiIiIKZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhbm5vdGF0aW9ucwoKZnJvbSBkYXRhY2xhc3NlcyBpbXBvcnQgZGF0YWNsYXNzLCBmaWVsZApmcm9tIHR5cGluZyBpbXBvcnQgQW55LCBEaWN0LCBJdGVyYWJsZSwgTGlzdCwgTWFwcGluZywgT3B0aW9uYWwsIFR1cGxlCmltcG9ydCBhc3QKaW1wb3J0IGhhc2hsaWIKQGRhdGFjbGFzcyhmcm96ZW49VHJ1ZSkKY2xhc3MgQXJ0aWZhY3Q6CiAgICAiIiJBIHJldXNhYmxlIHVuaXQgcHJvZHVjZWQgYnkgYW5hbHlzaXMgKG1vZHVsZS9mdW5jdGlvbi9jbGFzcy9ldGMuKS4iIiIKICAgIG5hbWU6IHN0cgogICAga2luZDogc3RyICAjIGUuZy4gbW9kdWxlLCBmdW5jdGlvbiwgY2xhc3MsIGVudHJ5cG9pbnQsIHRleHQKICAgIGNvbnRlbnQ6IHN0cgogICAgb3JpZ2luOiBzdHIgPSAiIgogICAgbWV0YWRhdGE6IERpY3Rbc3RyLCBBbnldID0gZmllbGQoZGVmYXVsdF9mYWN0b3J5PWRpY3QpCgogICAgQHByb3BlcnR5CiAgICBkZWYgc3RhYmxlX2lkKHNlbGYpIC0+IHN0cjoKICAgICAgICBoID0gaGFzaGxpYi5zaGEyNTYoKHNlbGYua2luZCArICJcbiIgKyBzZWxmLm5hbWUgKyAiXG4iICsgc2VsZi5jb250ZW50KS5lbmNvZGUoInV0Zi04IikpLmhleGRpZ2VzdCgpCiAgICAgICAgcmV0dXJuIGhbOjE2XQoKCkBkYXRhY2xhc3MKY2xhc3MgUmVmYWN0b3JSZXN1bHQ6CiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdCiAgICB3YXJuaW5nczogTGlzdFtzdHJdID0gZmllbGQoZGVmYXVsdF9mYWN0b3J5PWxpc3QpCiAgICBzdGF0czogRGljdFtzdHIsIEFueV0gPSBmaWVsZChkZWZhdWx0X2ZhY3Rvcnk9ZGljdCkKZGVmIF9sYW5ndWFnZV9mb3JfcGF0aChwYXRoOiBzdHIpIC0+IHN0cjoKICAgIHAgPSBwYXRoLmxvd2VyKCkKICAgIGlmIHAuZW5kc3dpdGgoIi5weSIpOgogICAgICAgIHJldHVybiAicHl0aG9uIgogICAgaWYgcC5lbmRzd2l0aCgiLm1kIikgb3IgcC5lbmRzd2l0aCgiLm1hcmtkb3duIik6CiAgICAgICAgcmV0dXJuICJtYXJrZG93biIKICAgIHJldHVybiAidGV4dCIKCgpkZWYgX3NsaWNlKHRleHQ6IHN0ciwgbm9kZTogYXN0LkFTVCkgLT4gT3B0aW9uYWxbc3RyXToKICAgIHRyeToKICAgICAgICByZXR1cm4gYXN0LmdldF9zb3VyY2Vfc2VnbWVudCh0ZXh0LCBub2RlKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gTm9uZQpkZWYgX3B5dGhvbl9hcnRpZmFjdHModGV4dDogc3RyLCBvcmlnaW46IHN0cikgLT4gVHVwbGVbTGlzdFtBcnRpZmFjdF0sIExpc3Rbc3RyXV06CiAgICB3YXJuaW5nczogTGlzdFtzdHJdID0gW10KICAgIHRyeToKICAgICAgICB0cmVlID0gYXN0LnBhcnNlKHRleHQpCiAgICBleGNlcHQgU3ludGF4RXJyb3IgYXMgZToKICAgICAgICByZXR1cm4gW0FydGlmYWN0KG5hbWU9b3JpZ2luLCBraW5kPSJ0ZXh0IiwgY29udGVudD10ZXh0LCBvcmlnaW49b3JpZ2luLCBtZXRhZGF0YT17InN5bnRheF9lcnJvciI6IHN0cihlKX0pXSwgW2Yie29yaWdpbn06IHtlfSJdCgogICAgbGluZXMgPSB0ZXh0LnNwbGl0bGluZXMoKQogICAgaW1wb3J0czogTGlzdFtzdHJdID0gW10KICAgIGRlZnM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIGVudHJ5cG9pbnQ6IExpc3Rbc3RyXSA9IFtdCiAgICBmb3IgbiBpbiB0cmVlLmJvZHk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShuLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKToKICAgICAgICAgICAgc2VnID0gX3NsaWNlKHRleHQsIG4pIG9yICIiCiAgICAgICAgICAgIGlmIHNlZy5zdHJpcCgpOgogICAgICAgICAgICAgICAgaW1wb3J0cy5hcHBlbmQoc2VnLnJzdHJpcCgpKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShuLCAoYXN0LkZ1bmN0aW9uRGVmLCBhc3QuQXN5bmNGdW5jdGlvbkRlZiwgYXN0LkNsYXNzRGVmKSk6CiAgICAgICAgICAgIHNlZyA9IF9zbGljZSh0ZXh0LCBuKQogICAgICAgICAgICBpZiBub3Qgc2VnOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAga2luZCA9ICJjbGFzcyIgaWYgaXNpbnN0YW5jZShuLCBhc3QuQ2xhc3NEZWYpIGVsc2UgImZ1bmN0aW9uIgogICAgICAgICAgICBkZWZzLmFwcGVuZChBcnRpZmFjdChuYW1lPW4ubmFtZSwga2luZD1raW5kLCBjb250ZW50PXNlZy5yc3RyaXAoKSArICJcbiIsIG9yaWdpbj1vcmlnaW4pKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShuLCBhc3QuSWYpOgogICAgICAgICAgICAjIGNhcHR1cmUgY29tbW9uIGVudHJ5cG9pbnQgcGF0dGVybgogICAgICAgICAgICB0ZXN0ID0gX3NsaWNlKHRleHQsIG4udGVzdCkgb3IgIiIKICAgICAgICAgICAgaWYgIl9fbmFtZV9fIiBpbiB0ZXN0IGFuZCAiX19tYWluX18iIGluIHRlc3Q6CiAgICAgICAgICAgICAgICBzZWcgPSBfc2xpY2UodGV4dCwgbikgb3IgIiIKICAgICAgICAgICAgICAgIGlmIHNlZy5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgIGVudHJ5cG9pbnQuYXBwZW5kKHNlZy5yc3RyaXAoKSkKCiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIGlmIGltcG9ydHM6CiAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPSJpbXBvcnRzIiwga2luZD0iaW1wb3J0cyIsIGNvbnRlbnQ9IlxuIi5qb2luKGltcG9ydHMpICsgIlxuIiwgb3JpZ2luPW9yaWdpbikpCiAgICBhcnRpZmFjdHMuZXh0ZW5kKGRlZnMpCiAgICBpZiBlbnRyeXBvaW50OgogICAgICAgIGFydGlmYWN0cy5hcHBlbmQoQXJ0aWZhY3QobmFtZT0iX19tYWluX18iLCBraW5kPSJlbnRyeXBvaW50IiwgY29udGVudD0iXG5cbiIuam9pbihlbnRyeXBvaW50KSArICJcbiIsIG9yaWdpbj1vcmlnaW4pKQoKICAgICMgSWYgbm90aGluZyBleHRyYWN0ZWQsIGtlZXAgZmlsZSBhcy1pcyB0byBhdm9pZCBkYXRhIGxvc3MKICAgIGlmIG5vdCBhcnRpZmFjdHM6CiAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPW9yaWdpbiwga2luZD0ibW9kdWxlIiwgY29udGVudD10ZXh0IGlmIHRleHQuZW5kc3dpdGgoIlxuIikgZWxzZSB0ZXh0ICsgIlxuIiwgb3JpZ2luPW9yaWdpbikpCiAgICByZXR1cm4gYXJ0aWZhY3RzLCB3YXJuaW5ncwpkZWYgYW5hbHl6ZV9zb3VyY2VzKHNvdXJjZXM6IE1hcHBpbmdbc3RyLCBzdHJdKSAtPiBSZWZhY3RvclJlc3VsdDoKICAgICIiIkFuYWx5emUgcGF0aC0+dGV4dCBtYXBwaW5nIGFuZCByZXR1cm4gc3RydWN0dXJlZCByZXVzYWJsZSBhcnRpZmFjdHMuIiIiCiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIHdhcm5pbmdzOiBMaXN0W3N0cl0gPSBbXQogICAgZm9yIHBhdGgsIHRleHQgaW4gc291cmNlcy5pdGVtcygpOgogICAgICAgIGxhbmcgPSBfbGFuZ3VhZ2VfZm9yX3BhdGgocGF0aCkKICAgICAgICBpZiBsYW5nID09ICJweXRob24iOgogICAgICAgICAgICBhLCB3ID0gX3B5dGhvbl9hcnRpZmFjdHModGV4dCwgb3JpZ2luPXBhdGgpCiAgICAgICAgICAgIGFydGlmYWN0cy5leHRlbmQoYSkKICAgICAgICAgICAgd2FybmluZ3MuZXh0ZW5kKHcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPXBhdGgsIGtpbmQ9bGFuZywgY29udGVudD10ZXh0IGlmIHRleHQuZW5kc3dpdGgoIlxuIikgZWxzZSB0ZXh0ICsgIlxuIiwgb3JpZ2luPXBhdGgpKQoKICAgIHN0YXRzID0gewogICAgICAgICJzb3VyY2VzIjogbGVuKHNvdXJjZXMpLAogICAgICAgICJhcnRpZmFjdHMiOiBsZW4oYXJ0aWZhY3RzKSwKICAgICAgICAia2luZHMiOiB7azogc3VtKDEgZm9yIGEgaW4gYXJ0aWZhY3RzIGlmIGEua2luZCA9PSBrKSBmb3IgayBpbiBzb3J0ZWQoe2Eua2luZCBmb3IgYSBpbiBhcnRpZmFjdHN9KX0sCiAgICB9CiAgICByZXR1cm4gUmVmYWN0b3JSZXN1bHQoYXJ0aWZhY3RzPWFydGlmYWN0cywgd2FybmluZ3M9d2FybmluZ3MsIHN0YXRzPXN0YXRzKQpkZWYgcHJvcG9zZV9tb2R1bGVzKHJlc3VsdDogUmVmYWN0b3JSZXN1bHQpIC0+IERpY3Rbc3RyLCBMaXN0W0FydGlmYWN0XV06CiAgICAiIiJHcm91cCBhcnRpZmFjdHMgaW50byBzdWdnZXN0ZWQgbW9kdWxlIGZpbGVzLgoKICAgIEhldXJpc3RpYzoKICAgIC0gaW1wb3J0cyBhcmUgZ3JvdXBlZCBpbnRvIGEgcGVyLW9yaWdpbiBwc2V1ZG8tbW9kdWxlCiAgICAtIGZ1bmN0aW9ucyB3aXRoIGhlbHBlci1pc2ggbmFtZXMgZ28gdG8gdXRpbHMucHkKICAgIC0gb3RoZXIgZGVmcyBnbyB0byBhIG1vZHVsZSBkZXJpdmVkIGZyb20gb3JpZ2luIGZpbGUgbmFtZQogICAgLSBub24tcHl0aG9uL3RleHQgYXJ0aWZhY3RzIGtlZXAgdGhlaXIgb3JpZ2luLWRlcml2ZWQgbmFtZXMKICAgICIiIgogICAgZ3JvdXBlZDogRGljdFtzdHIsIExpc3RbQXJ0aWZhY3RdXSA9IHt9CiAgICBmb3IgYSBpbiByZXN1bHQuYXJ0aWZhY3RzOgogICAgICAgIGlmIGEua2luZCBpbiB7Im1hcmtkb3duIiwgInRleHQifToKICAgICAgICAgICAgbW9kID0gYS5vcmlnaW4gb3IgYS5uYW1lCiAgICAgICAgZWxpZiBhLmtpbmQgPT0gImltcG9ydHMiOgogICAgICAgICAgICBiYXNlID0gUGF0aChhLm9yaWdpbikuc3RlbSBpZiBhLm9yaWdpbiBlbHNlICJtb2R1bGUiCiAgICAgICAgICAgIG1vZCA9IGYie2Jhc2V9LnB5IgogICAgICAgIGVsaWYgYS5raW5kIGluIHsiZnVuY3Rpb24iLCAiY2xhc3MiLCAiZW50cnlwb2ludCJ9OgogICAgICAgICAgICBubSA9IGEubmFtZS5sb3dlcigpCiAgICAgICAgICAgIGlmIGFueSh0IGluIG5tIGZvciB0IGluICgidXRpbCIsICJoZWxwZXIiLCAicGFyc2VfIiwgInJlYWRfIiwgIndyaXRlXyIsICJzbHVnIiwgIm5vcm1hbGl6ZSIpKToKICAgICAgICAgICAgICAgIG1vZCA9ICJ1dGlscy5weSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJhc2UgPSBQYXRoKGEub3JpZ2luKS5zdGVtIGlmIGEub3JpZ2luIGVsc2UgIm1vZHVsZSIKICAgICAgICAgICAgICAgIG1vZCA9IGYie2Jhc2V9LnB5IgogICAgICAgIGVsc2U6ICAjIG1vZHVsZS91bmtub3duCiAgICAgICAgICAgIG1vZCA9IFBhdGgoYS5vcmlnaW4pLm5hbWUgaWYgYS5vcmlnaW4gZWxzZSAibW9kdWxlLnB5IgogICAgICAgIGdyb3VwZWQuc2V0ZGVmYXVsdChtb2QsIFtdKS5hcHBlbmQoYSkKCiAgICAjIHN0YWJsZSBvcmRlcmluZzogaW1wb3J0cyBmaXJzdCwgdGhlbiBjbGFzc2VzLCB0aGVuIGZ1bmN0aW9ucywgdGhlbiBlbnRyeXBvaW50L3RleHQKICAgIG9yZGVyID0geyJpbXBvcnRzIjogMCwgImNsYXNzIjogMSwgImZ1bmN0aW9uIjogMiwgImVudHJ5cG9pbnQiOiAzLCAibW9kdWxlIjogNCwgIm1hcmtkb3duIjogNSwgInRleHQiOiA2fQogICAgZm9yIG1vZCwgaXRlbXMgaW4gbGlzdChncm91cGVkLml0ZW1zKCkpOgogICAgICAgIGdyb3VwZWRbbW9kXSA9IHNvcnRlZChpdGVtcywga2V5PWxhbWJkYSB4OiAob3JkZXIuZ2V0KHgua2luZCwgOTkpLCB4Lm5hbWUpKQogICAgcmV0dXJuIGdyb3VwZWQKZGVmIHJlZmFjdG9yX2FuZF9tb2R1bGFyaXplKHNvdXJjZXM6IE1hcHBpbmdbc3RyLCBzdHJdKSAtPiBUdXBsZVtSZWZhY3RvclJlc3VsdCwgRGljdFtzdHIsIHN0cl1dOgogICAgIiIiRW5kLXRvLWVuZCBoZWxwZXIgcmV0dXJuaW5nIGFuYWx5c2lzIHBsdXMgcmVuZGVyZWQgbW9kdWxlIHRleHRzLiIiIgogICAgcmVzdWx0ID0gYW5hbHl6ZV9zb3VyY2VzKHNvdXJjZXMpCiAgICBtb2R1bGVzOiBEaWN0W3N0ciwgc3RyXSA9IHt9CiAgICBmb3IgbW9kLCBpdGVtcyBpbiBwcm9wb3NlX21vZHVsZXMocmVzdWx0KS5pdGVtcygpOgogICAgICAgIGlmIG1vZC5lbmRzd2l0aCgiLnB5Iik6CiAgICAgICAgICAgIGJvZHkgPSAiXG5cbiIuam9pbihpLmNvbnRlbnQucnN0cmlwKCJcbiIpIGZvciBpIGluIGl0ZW1zKS5yc3RyaXAoKSArICJcbiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBib2R5ID0gIlxuIi5qb2luKGkuY29udGVudC5yc3RyaXAoIlxuIikgZm9yIGkgaW4gaXRlbXMpLnJzdHJpcCgpICsgIlxuIgogICAgICAgIG1vZHVsZXNbbW9kXSA9IGJvZHkKICAgIHJldHVybiByZXN1bHQsIG1vZHVsZXMK\"}\nDIR_STATE:[\"src/refactor_modularize/__init__.py\",\"src/refactor_modularize/export.py\",\"src/refactor_modularize/refactor.py\",\"src/refactor_modularize/utils.py\"]",
  "reasoning": "",
  "responseId": "resp_0ae00c372c12071600694b4aa7d2a48195a7a5f7a83a77e4e5",
  "model": "gpt-5.2-2025-12-11",
  "usage": {
    "input_tokens": 6603,
    "input_tokens_details": {
      "cached_tokens": 0
    },
    "output_tokens": 5570,
    "output_tokens_details": {
      "reasoning_tokens": 44
    },
    "total_tokens": 12173
  },
  "hadError": false,
  "errorType": null,
  "webSearchSources": [],
  "citations": [],
  "output": [
    {
      "id": "rs_0ae00c372c12071600694b4aa86bf88195a9a4f155ae735549",
      "type": "reasoning",
      "summary": []
    },
    {
      "id": "ci_0ae00c372c12071600694b4aa90e3481958480c06dec90dfcc",
      "type": "code_interpreter_call",
      "status": "completed",
      "code": "from pathlib import Path\nimport base64, json, hashlib, gzip\n\ntarget_path = Path('/mnt/data').joinpath('src/refactor_modularize/refactor.py')\nassert target_path.is_file(), 'Expected src/refactor_modularize/refactor.py to exist before export'\ndata = target_path.read_bytes()\npayload = {\n  'path': 'src/refactor_modularize/refactor.py',\n  'size': len(data),\n  'encoding': 'base64',\n  'sha256': hashlib.sha256(data).hexdigest(),\n  'content': None\n}\nif len(data) > 20000:\n    compressed = gzip.compress(data)\n    payload['encoding'] = 'gzip+base64'\n    payload['content'] = base64.b64encode(compressed).decode('ascii')\nelse:\n    payload['content'] = base64.b64encode(data).decode('ascii')\n\nprint('FILE_EXPORT:' + json.dumps(payload, separators=(',', ':')))\nprint('DIR_STATE:' + json.dumps(sorted(str(p.relative_to(Path(\"/mnt/data\"))) for p in target_path.parent.glob('*') if p.is_file())))",
      "container_id": "cntr_694b49f988e88190b0cbb25ca37056a608ca97619881281d",
      "outputs": [
        {
          "type": "logs",
          "logs": "FILE_EXPORT:{\"path\":\"src/refactor_modularize/refactor.py\",\"size\":6285,\"encoding\":\"base64\",\"sha256\":\"c7abc11f6f76e64d1d708b9360a15e697cb0214fb54b6792de9ce79ce85b5bd8\",\"content\":\"IiIiQ29yZSByZWZhY3RvcmluZyArIG1vZHVsYXJpemF0aW9uIGxvZ2ljLgoKVGhpcyBtb2R1bGUgYW5hbHl6ZXMgaW5wdXQgc291cmNlIHRleHRzIChwcmltYXJpbHkgUHl0aG9uKSBhbmQgZW1pdHMgc3RydWN0dXJlZAoiYXJ0aWZhY3RzIiB0aGF0IGNhbiBiZSByZS11c2VkIGJ5IGV4cG9ydCBoZWxwZXJzIChlLmcuLCB3cml0dGVuIGFzIG1vZHVsZXMpLgpUaGUgaGV1cmlzdGljcyBhcmUgaW50ZW50aW9uYWxseSBsaWdodHdlaWdodCBhbmQgZGVwZW5kZW5jeS1mcmVlLgoiIiIKZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhbm5vdGF0aW9ucwoKZnJvbSBkYXRhY2xhc3NlcyBpbXBvcnQgZGF0YWNsYXNzLCBmaWVsZApmcm9tIHR5cGluZyBpbXBvcnQgQW55LCBEaWN0LCBJdGVyYWJsZSwgTGlzdCwgTWFwcGluZywgT3B0aW9uYWwsIFR1cGxlCmltcG9ydCBhc3QKaW1wb3J0IGhhc2hsaWIKQGRhdGFjbGFzcyhmcm96ZW49VHJ1ZSkKY2xhc3MgQXJ0aWZhY3Q6CiAgICAiIiJBIHJldXNhYmxlIHVuaXQgcHJvZHVjZWQgYnkgYW5hbHlzaXMgKG1vZHVsZS9mdW5jdGlvbi9jbGFzcy9ldGMuKS4iIiIKICAgIG5hbWU6IHN0cgogICAga2luZDogc3RyICAjIGUuZy4gbW9kdWxlLCBmdW5jdGlvbiwgY2xhc3MsIGVudHJ5cG9pbnQsIHRleHQKICAgIGNvbnRlbnQ6IHN0cgogICAgb3JpZ2luOiBzdHIgPSAiIgogICAgbWV0YWRhdGE6IERpY3Rbc3RyLCBBbnldID0gZmllbGQoZGVmYXVsdF9mYWN0b3J5PWRpY3QpCgogICAgQHByb3BlcnR5CiAgICBkZWYgc3RhYmxlX2lkKHNlbGYpIC0+IHN0cjoKICAgICAgICBoID0gaGFzaGxpYi5zaGEyNTYoKHNlbGYua2luZCArICJcbiIgKyBzZWxmLm5hbWUgKyAiXG4iICsgc2VsZi5jb250ZW50KS5lbmNvZGUoInV0Zi04IikpLmhleGRpZ2VzdCgpCiAgICAgICAgcmV0dXJuIGhbOjE2XQoKCkBkYXRhY2xhc3MKY2xhc3MgUmVmYWN0b3JSZXN1bHQ6CiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdCiAgICB3YXJuaW5nczogTGlzdFtzdHJdID0gZmllbGQoZGVmYXVsdF9mYWN0b3J5PWxpc3QpCiAgICBzdGF0czogRGljdFtzdHIsIEFueV0gPSBmaWVsZChkZWZhdWx0X2ZhY3Rvcnk9ZGljdCkKZGVmIF9sYW5ndWFnZV9mb3JfcGF0aChwYXRoOiBzdHIpIC0+IHN0cjoKICAgIHAgPSBwYXRoLmxvd2VyKCkKICAgIGlmIHAuZW5kc3dpdGgoIi5weSIpOgogICAgICAgIHJldHVybiAicHl0aG9uIgogICAgaWYgcC5lbmRzd2l0aCgiLm1kIikgb3IgcC5lbmRzd2l0aCgiLm1hcmtkb3duIik6CiAgICAgICAgcmV0dXJuICJtYXJrZG93biIKICAgIHJldHVybiAidGV4dCIKCgpkZWYgX3NsaWNlKHRleHQ6IHN0ciwgbm9kZTogYXN0LkFTVCkgLT4gT3B0aW9uYWxbc3RyXToKICAgIHRyeToKICAgICAgICByZXR1cm4gYXN0LmdldF9zb3VyY2Vfc2VnbWVudCh0ZXh0LCBub2RlKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gTm9uZQpkZWYgX3B5dGhvbl9hcnRpZmFjdHModGV4dDogc3RyLCBvcmlnaW46IHN0cikgLT4gVHVwbGVbTGlzdFtBcnRpZmFjdF0sIExpc3Rbc3RyXV06CiAgICB3YXJuaW5nczogTGlzdFtzdHJdID0gW10KICAgIHRyeToKICAgICAgICB0cmVlID0gYXN0LnBhcnNlKHRleHQpCiAgICBleGNlcHQgU3ludGF4RXJyb3IgYXMgZToKICAgICAgICByZXR1cm4gW0FydGlmYWN0KG5hbWU9b3JpZ2luLCBraW5kPSJ0ZXh0IiwgY29udGVudD10ZXh0LCBvcmlnaW49b3JpZ2luLCBtZXRhZGF0YT17InN5bnRheF9lcnJvciI6IHN0cihlKX0pXSwgW2Yie29yaWdpbn06IHtlfSJdCgogICAgbGluZXMgPSB0ZXh0LnNwbGl0bGluZXMoKQogICAgaW1wb3J0czogTGlzdFtzdHJdID0gW10KICAgIGRlZnM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIGVudHJ5cG9pbnQ6IExpc3Rbc3RyXSA9IFtdCiAgICBmb3IgbiBpbiB0cmVlLmJvZHk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShuLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKToKICAgICAgICAgICAgc2VnID0gX3NsaWNlKHRleHQsIG4pIG9yICIiCiAgICAgICAgICAgIGlmIHNlZy5zdHJpcCgpOgogICAgICAgICAgICAgICAgaW1wb3J0cy5hcHBlbmQoc2VnLnJzdHJpcCgpKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShuLCAoYXN0LkZ1bmN0aW9uRGVmLCBhc3QuQXN5bmNGdW5jdGlvbkRlZiwgYXN0LkNsYXNzRGVmKSk6CiAgICAgICAgICAgIHNlZyA9IF9zbGljZSh0ZXh0LCBuKQogICAgICAgICAgICBpZiBub3Qgc2VnOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAga2luZCA9ICJjbGFzcyIgaWYgaXNpbnN0YW5jZShuLCBhc3QuQ2xhc3NEZWYpIGVsc2UgImZ1bmN0aW9uIgogICAgICAgICAgICBkZWZzLmFwcGVuZChBcnRpZmFjdChuYW1lPW4ubmFtZSwga2luZD1raW5kLCBjb250ZW50PXNlZy5yc3RyaXAoKSArICJcbiIsIG9yaWdpbj1vcmlnaW4pKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShuLCBhc3QuSWYpOgogICAgICAgICAgICAjIGNhcHR1cmUgY29tbW9uIGVudHJ5cG9pbnQgcGF0dGVybgogICAgICAgICAgICB0ZXN0ID0gX3NsaWNlKHRleHQsIG4udGVzdCkgb3IgIiIKICAgICAgICAgICAgaWYgIl9fbmFtZV9fIiBpbiB0ZXN0IGFuZCAiX19tYWluX18iIGluIHRlc3Q6CiAgICAgICAgICAgICAgICBzZWcgPSBfc2xpY2UodGV4dCwgbikgb3IgIiIKICAgICAgICAgICAgICAgIGlmIHNlZy5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgIGVudHJ5cG9pbnQuYXBwZW5kKHNlZy5yc3RyaXAoKSkKCiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIGlmIGltcG9ydHM6CiAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPSJpbXBvcnRzIiwga2luZD0iaW1wb3J0cyIsIGNvbnRlbnQ9IlxuIi5qb2luKGltcG9ydHMpICsgIlxuIiwgb3JpZ2luPW9yaWdpbikpCiAgICBhcnRpZmFjdHMuZXh0ZW5kKGRlZnMpCiAgICBpZiBlbnRyeXBvaW50OgogICAgICAgIGFydGlmYWN0cy5hcHBlbmQoQXJ0aWZhY3QobmFtZT0iX19tYWluX18iLCBraW5kPSJlbnRyeXBvaW50IiwgY29udGVudD0iXG5cbiIuam9pbihlbnRyeXBvaW50KSArICJcbiIsIG9yaWdpbj1vcmlnaW4pKQoKICAgICMgSWYgbm90aGluZyBleHRyYWN0ZWQsIGtlZXAgZmlsZSBhcy1pcyB0byBhdm9pZCBkYXRhIGxvc3MKICAgIGlmIG5vdCBhcnRpZmFjdHM6CiAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPW9yaWdpbiwga2luZD0ibW9kdWxlIiwgY29udGVudD10ZXh0IGlmIHRleHQuZW5kc3dpdGgoIlxuIikgZWxzZSB0ZXh0ICsgIlxuIiwgb3JpZ2luPW9yaWdpbikpCiAgICByZXR1cm4gYXJ0aWZhY3RzLCB3YXJuaW5ncwpkZWYgYW5hbHl6ZV9zb3VyY2VzKHNvdXJjZXM6IE1hcHBpbmdbc3RyLCBzdHJdKSAtPiBSZWZhY3RvclJlc3VsdDoKICAgICIiIkFuYWx5emUgcGF0aC0+dGV4dCBtYXBwaW5nIGFuZCByZXR1cm4gc3RydWN0dXJlZCByZXVzYWJsZSBhcnRpZmFjdHMuIiIiCiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIHdhcm5pbmdzOiBMaXN0W3N0cl0gPSBbXQogICAgZm9yIHBhdGgsIHRleHQgaW4gc291cmNlcy5pdGVtcygpOgogICAgICAgIGxhbmcgPSBfbGFuZ3VhZ2VfZm9yX3BhdGgocGF0aCkKICAgICAgICBpZiBsYW5nID09ICJweXRob24iOgogICAgICAgICAgICBhLCB3ID0gX3B5dGhvbl9hcnRpZmFjdHModGV4dCwgb3JpZ2luPXBhdGgpCiAgICAgICAgICAgIGFydGlmYWN0cy5leHRlbmQoYSkKICAgICAgICAgICAgd2FybmluZ3MuZXh0ZW5kKHcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPXBhdGgsIGtpbmQ9bGFuZywgY29udGVudD10ZXh0IGlmIHRleHQuZW5kc3dpdGgoIlxuIikgZWxzZSB0ZXh0ICsgIlxuIiwgb3JpZ2luPXBhdGgpKQoKICAgIHN0YXRzID0gewogICAgICAgICJzb3VyY2VzIjogbGVuKHNvdXJjZXMpLAogICAgICAgICJhcnRpZmFjdHMiOiBsZW4oYXJ0aWZhY3RzKSwKICAgICAgICAia2luZHMiOiB7azogc3VtKDEgZm9yIGEgaW4gYXJ0aWZhY3RzIGlmIGEua2luZCA9PSBrKSBmb3IgayBpbiBzb3J0ZWQoe2Eua2luZCBmb3IgYSBpbiBhcnRpZmFjdHN9KX0sCiAgICB9CiAgICByZXR1cm4gUmVmYWN0b3JSZXN1bHQoYXJ0aWZhY3RzPWFydGlmYWN0cywgd2FybmluZ3M9d2FybmluZ3MsIHN0YXRzPXN0YXRzKQpkZWYgcHJvcG9zZV9tb2R1bGVzKHJlc3VsdDogUmVmYWN0b3JSZXN1bHQpIC0+IERpY3Rbc3RyLCBMaXN0W0FydGlmYWN0XV06CiAgICAiIiJHcm91cCBhcnRpZmFjdHMgaW50byBzdWdnZXN0ZWQgbW9kdWxlIGZpbGVzLgoKICAgIEhldXJpc3RpYzoKICAgIC0gaW1wb3J0cyBhcmUgZ3JvdXBlZCBpbnRvIGEgcGVyLW9yaWdpbiBwc2V1ZG8tbW9kdWxlCiAgICAtIGZ1bmN0aW9ucyB3aXRoIGhlbHBlci1pc2ggbmFtZXMgZ28gdG8gdXRpbHMucHkKICAgIC0gb3RoZXIgZGVmcyBnbyB0byBhIG1vZHVsZSBkZXJpdmVkIGZyb20gb3JpZ2luIGZpbGUgbmFtZQogICAgLSBub24tcHl0aG9uL3RleHQgYXJ0aWZhY3RzIGtlZXAgdGhlaXIgb3JpZ2luLWRlcml2ZWQgbmFtZXMKICAgICIiIgogICAgZ3JvdXBlZDogRGljdFtzdHIsIExpc3RbQXJ0aWZhY3RdXSA9IHt9CiAgICBmb3IgYSBpbiByZXN1bHQuYXJ0aWZhY3RzOgogICAgICAgIGlmIGEua2luZCBpbiB7Im1hcmtkb3duIiwgInRleHQifToKICAgICAgICAgICAgbW9kID0gYS5vcmlnaW4gb3IgYS5uYW1lCiAgICAgICAgZWxpZiBhLmtpbmQgPT0gImltcG9ydHMiOgogICAgICAgICAgICBiYXNlID0gUGF0aChhLm9yaWdpbikuc3RlbSBpZiBhLm9yaWdpbiBlbHNlICJtb2R1bGUiCiAgICAgICAgICAgIG1vZCA9IGYie2Jhc2V9LnB5IgogICAgICAgIGVsaWYgYS5raW5kIGluIHsiZnVuY3Rpb24iLCAiY2xhc3MiLCAiZW50cnlwb2ludCJ9OgogICAgICAgICAgICBubSA9IGEubmFtZS5sb3dlcigpCiAgICAgICAgICAgIGlmIGFueSh0IGluIG5tIGZvciB0IGluICgidXRpbCIsICJoZWxwZXIiLCAicGFyc2VfIiwgInJlYWRfIiwgIndyaXRlXyIsICJzbHVnIiwgIm5vcm1hbGl6ZSIpKToKICAgICAgICAgICAgICAgIG1vZCA9ICJ1dGlscy5weSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJhc2UgPSBQYXRoKGEub3JpZ2luKS5zdGVtIGlmIGEub3JpZ2luIGVsc2UgIm1vZHVsZSIKICAgICAgICAgICAgICAgIG1vZCA9IGYie2Jhc2V9LnB5IgogICAgICAgIGVsc2U6ICAjIG1vZHVsZS91bmtub3duCiAgICAgICAgICAgIG1vZCA9IFBhdGgoYS5vcmlnaW4pLm5hbWUgaWYgYS5vcmlnaW4gZWxzZSAibW9kdWxlLnB5IgogICAgICAgIGdyb3VwZWQuc2V0ZGVmYXVsdChtb2QsIFtdKS5hcHBlbmQoYSkKCiAgICAjIHN0YWJsZSBvcmRlcmluZzogaW1wb3J0cyBmaXJzdCwgdGhlbiBjbGFzc2VzLCB0aGVuIGZ1bmN0aW9ucywgdGhlbiBlbnRyeXBvaW50L3RleHQKICAgIG9yZGVyID0geyJpbXBvcnRzIjogMCwgImNsYXNzIjogMSwgImZ1bmN0aW9uIjogMiwgImVudHJ5cG9pbnQiOiAzLCAibW9kdWxlIjogNCwgIm1hcmtkb3duIjogNSwgInRleHQiOiA2fQogICAgZm9yIG1vZCwgaXRlbXMgaW4gbGlzdChncm91cGVkLml0ZW1zKCkpOgogICAgICAgIGdyb3VwZWRbbW9kXSA9IHNvcnRlZChpdGVtcywga2V5PWxhbWJkYSB4OiAob3JkZXIuZ2V0KHgua2luZCwgOTkpLCB4Lm5hbWUpKQogICAgcmV0dXJuIGdyb3VwZWQKZGVmIHJlZmFjdG9yX2FuZF9tb2R1bGFyaXplKHNvdXJjZXM6IE1hcHBpbmdbc3RyLCBzdHJdKSAtPiBUdXBsZVtSZWZhY3RvclJlc3VsdCwgRGljdFtzdHIsIHN0cl1dOgogICAgIiIiRW5kLXRvLWVuZCBoZWxwZXIgcmV0dXJuaW5nIGFuYWx5c2lzIHBsdXMgcmVuZGVyZWQgbW9kdWxlIHRleHRzLiIiIgogICAgcmVzdWx0ID0gYW5hbHl6ZV9zb3VyY2VzKHNvdXJjZXMpCiAgICBtb2R1bGVzOiBEaWN0W3N0ciwgc3RyXSA9IHt9CiAgICBmb3IgbW9kLCBpdGVtcyBpbiBwcm9wb3NlX21vZHVsZXMocmVzdWx0KS5pdGVtcygpOgogICAgICAgIGlmIG1vZC5lbmRzd2l0aCgiLnB5Iik6CiAgICAgICAgICAgIGJvZHkgPSAiXG5cbiIuam9pbihpLmNvbnRlbnQucnN0cmlwKCJcbiIpIGZvciBpIGluIGl0ZW1zKS5yc3RyaXAoKSArICJcbiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBib2R5ID0gIlxuIi5qb2luKGkuY29udGVudC5yc3RyaXAoIlxuIikgZm9yIGkgaW4gaXRlbXMpLnJzdHJpcCgpICsgIlxuIgogICAgICAgIG1vZHVsZXNbbW9kXSA9IGJvZHkKICAgIHJldHVybiByZXN1bHQsIG1vZHVsZXMK\"}\nDIR_STATE:[\"src/refactor_modularize/__init__.py\", \"src/refactor_modularize/export.py\", \"src/refactor_modularize/refactor.py\", \"src/refactor_modularize/utils.py\"]\n"
        }
      ]
    },
    {
      "id": "msg_0ae00c372c12071600694b4aabfdc88195889f9b373e40aea7",
      "type": "message",
      "status": "completed",
      "content": [
        {
          "type": "output_text",
          "annotations": [],
          "logprobs": [],
          "text": "FILE_EXPORT:{\"path\":\"src/refactor_modularize/refactor.py\",\"size\":6285,\"encoding\":\"base64\",\"sha256\":\"c7abc11f6f76e64d1d708b9360a15e697cb0214fb54b6792de9ce79ce85b5bd8\",\"content\":\"IiIiQ29yZSByZWZhY3RvcmluZyArIG1vZHVsYXJpemF0aW9uIGxvZ2ljLgoKVGhpcyBtb2R1bGUgYW5hbHl6ZXMgaW5wdXQgc291cmNlIHRleHRzIChwcmltYXJpbHkgUHl0aG9uKSBhbmQgZW1pdHMgc3RydWN0dXJlZAoiYXJ0aWZhY3RzIiB0aGF0IGNhbiBiZSByZS11c2VkIGJ5IGV4cG9ydCBoZWxwZXJzIChlLmcuLCB3cml0dGVuIGFzIG1vZHVsZXMpLgpUaGUgaGV1cmlzdGljcyBhcmUgaW50ZW50aW9uYWxseSBsaWdodHdlaWdodCBhbmQgZGVwZW5kZW5jeS1mcmVlLgoiIiIKZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhbm5vdGF0aW9ucwoKZnJvbSBkYXRhY2xhc3NlcyBpbXBvcnQgZGF0YWNsYXNzLCBmaWVsZApmcm9tIHR5cGluZyBpbXBvcnQgQW55LCBEaWN0LCBJdGVyYWJsZSwgTGlzdCwgTWFwcGluZywgT3B0aW9uYWwsIFR1cGxlCmltcG9ydCBhc3QKaW1wb3J0IGhhc2hsaWIKQGRhdGFjbGFzcyhmcm96ZW49VHJ1ZSkKY2xhc3MgQXJ0aWZhY3Q6CiAgICAiIiJBIHJldXNhYmxlIHVuaXQgcHJvZHVjZWQgYnkgYW5hbHlzaXMgKG1vZHVsZS9mdW5jdGlvbi9jbGFzcy9ldGMuKS4iIiIKICAgIG5hbWU6IHN0cgogICAga2luZDogc3RyICAjIGUuZy4gbW9kdWxlLCBmdW5jdGlvbiwgY2xhc3MsIGVudHJ5cG9pbnQsIHRleHQKICAgIGNvbnRlbnQ6IHN0cgogICAgb3JpZ2luOiBzdHIgPSAiIgogICAgbWV0YWRhdGE6IERpY3Rbc3RyLCBBbnldID0gZmllbGQoZGVmYXVsdF9mYWN0b3J5PWRpY3QpCgogICAgQHByb3BlcnR5CiAgICBkZWYgc3RhYmxlX2lkKHNlbGYpIC0+IHN0cjoKICAgICAgICBoID0gaGFzaGxpYi5zaGEyNTYoKHNlbGYua2luZCArICJcbiIgKyBzZWxmLm5hbWUgKyAiXG4iICsgc2VsZi5jb250ZW50KS5lbmNvZGUoInV0Zi04IikpLmhleGRpZ2VzdCgpCiAgICAgICAgcmV0dXJuIGhbOjE2XQoKCkBkYXRhY2xhc3MKY2xhc3MgUmVmYWN0b3JSZXN1bHQ6CiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdCiAgICB3YXJuaW5nczogTGlzdFtzdHJdID0gZmllbGQoZGVmYXVsdF9mYWN0b3J5PWxpc3QpCiAgICBzdGF0czogRGljdFtzdHIsIEFueV0gPSBmaWVsZChkZWZhdWx0X2ZhY3Rvcnk9ZGljdCkKZGVmIF9sYW5ndWFnZV9mb3JfcGF0aChwYXRoOiBzdHIpIC0+IHN0cjoKICAgIHAgPSBwYXRoLmxvd2VyKCkKICAgIGlmIHAuZW5kc3dpdGgoIi5weSIpOgogICAgICAgIHJldHVybiAicHl0aG9uIgogICAgaWYgcC5lbmRzd2l0aCgiLm1kIikgb3IgcC5lbmRzd2l0aCgiLm1hcmtkb3duIik6CiAgICAgICAgcmV0dXJuICJtYXJrZG93biIKICAgIHJldHVybiAidGV4dCIKCgpkZWYgX3NsaWNlKHRleHQ6IHN0ciwgbm9kZTogYXN0LkFTVCkgLT4gT3B0aW9uYWxbc3RyXToKICAgIHRyeToKICAgICAgICByZXR1cm4gYXN0LmdldF9zb3VyY2Vfc2VnbWVudCh0ZXh0LCBub2RlKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gTm9uZQpkZWYgX3B5dGhvbl9hcnRpZmFjdHModGV4dDogc3RyLCBvcmlnaW46IHN0cikgLT4gVHVwbGVbTGlzdFtBcnRpZmFjdF0sIExpc3Rbc3RyXV06CiAgICB3YXJuaW5nczogTGlzdFtzdHJdID0gW10KICAgIHRyeToKICAgICAgICB0cmVlID0gYXN0LnBhcnNlKHRleHQpCiAgICBleGNlcHQgU3ludGF4RXJyb3IgYXMgZToKICAgICAgICByZXR1cm4gW0FydGlmYWN0KG5hbWU9b3JpZ2luLCBraW5kPSJ0ZXh0IiwgY29udGVudD10ZXh0LCBvcmlnaW49b3JpZ2luLCBtZXRhZGF0YT17InN5bnRheF9lcnJvciI6IHN0cihlKX0pXSwgW2Yie29yaWdpbn06IHtlfSJdCgogICAgbGluZXMgPSB0ZXh0LnNwbGl0bGluZXMoKQogICAgaW1wb3J0czogTGlzdFtzdHJdID0gW10KICAgIGRlZnM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIGVudHJ5cG9pbnQ6IExpc3Rbc3RyXSA9IFtdCiAgICBmb3IgbiBpbiB0cmVlLmJvZHk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShuLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKToKICAgICAgICAgICAgc2VnID0gX3NsaWNlKHRleHQsIG4pIG9yICIiCiAgICAgICAgICAgIGlmIHNlZy5zdHJpcCgpOgogICAgICAgICAgICAgICAgaW1wb3J0cy5hcHBlbmQoc2VnLnJzdHJpcCgpKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShuLCAoYXN0LkZ1bmN0aW9uRGVmLCBhc3QuQXN5bmNGdW5jdGlvbkRlZiwgYXN0LkNsYXNzRGVmKSk6CiAgICAgICAgICAgIHNlZyA9IF9zbGljZSh0ZXh0LCBuKQogICAgICAgICAgICBpZiBub3Qgc2VnOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAga2luZCA9ICJjbGFzcyIgaWYgaXNpbnN0YW5jZShuLCBhc3QuQ2xhc3NEZWYpIGVsc2UgImZ1bmN0aW9uIgogICAgICAgICAgICBkZWZzLmFwcGVuZChBcnRpZmFjdChuYW1lPW4ubmFtZSwga2luZD1raW5kLCBjb250ZW50PXNlZy5yc3RyaXAoKSArICJcbiIsIG9yaWdpbj1vcmlnaW4pKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShuLCBhc3QuSWYpOgogICAgICAgICAgICAjIGNhcHR1cmUgY29tbW9uIGVudHJ5cG9pbnQgcGF0dGVybgogICAgICAgICAgICB0ZXN0ID0gX3NsaWNlKHRleHQsIG4udGVzdCkgb3IgIiIKICAgICAgICAgICAgaWYgIl9fbmFtZV9fIiBpbiB0ZXN0IGFuZCAiX19tYWluX18iIGluIHRlc3Q6CiAgICAgICAgICAgICAgICBzZWcgPSBfc2xpY2UodGV4dCwgbikgb3IgIiIKICAgICAgICAgICAgICAgIGlmIHNlZy5zdHJpcCgpOgogICAgICAgICAgICAgICAgICAgIGVudHJ5cG9pbnQuYXBwZW5kKHNlZy5yc3RyaXAoKSkKCiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIGlmIGltcG9ydHM6CiAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPSJpbXBvcnRzIiwga2luZD0iaW1wb3J0cyIsIGNvbnRlbnQ9IlxuIi5qb2luKGltcG9ydHMpICsgIlxuIiwgb3JpZ2luPW9yaWdpbikpCiAgICBhcnRpZmFjdHMuZXh0ZW5kKGRlZnMpCiAgICBpZiBlbnRyeXBvaW50OgogICAgICAgIGFydGlmYWN0cy5hcHBlbmQoQXJ0aWZhY3QobmFtZT0iX19tYWluX18iLCBraW5kPSJlbnRyeXBvaW50IiwgY29udGVudD0iXG5cbiIuam9pbihlbnRyeXBvaW50KSArICJcbiIsIG9yaWdpbj1vcmlnaW4pKQoKICAgICMgSWYgbm90aGluZyBleHRyYWN0ZWQsIGtlZXAgZmlsZSBhcy1pcyB0byBhdm9pZCBkYXRhIGxvc3MKICAgIGlmIG5vdCBhcnRpZmFjdHM6CiAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPW9yaWdpbiwga2luZD0ibW9kdWxlIiwgY29udGVudD10ZXh0IGlmIHRleHQuZW5kc3dpdGgoIlxuIikgZWxzZSB0ZXh0ICsgIlxuIiwgb3JpZ2luPW9yaWdpbikpCiAgICByZXR1cm4gYXJ0aWZhY3RzLCB3YXJuaW5ncwpkZWYgYW5hbHl6ZV9zb3VyY2VzKHNvdXJjZXM6IE1hcHBpbmdbc3RyLCBzdHJdKSAtPiBSZWZhY3RvclJlc3VsdDoKICAgICIiIkFuYWx5emUgcGF0aC0+dGV4dCBtYXBwaW5nIGFuZCByZXR1cm4gc3RydWN0dXJlZCByZXVzYWJsZSBhcnRpZmFjdHMuIiIiCiAgICBhcnRpZmFjdHM6IExpc3RbQXJ0aWZhY3RdID0gW10KICAgIHdhcm5pbmdzOiBMaXN0W3N0cl0gPSBbXQogICAgZm9yIHBhdGgsIHRleHQgaW4gc291cmNlcy5pdGVtcygpOgogICAgICAgIGxhbmcgPSBfbGFuZ3VhZ2VfZm9yX3BhdGgocGF0aCkKICAgICAgICBpZiBsYW5nID09ICJweXRob24iOgogICAgICAgICAgICBhLCB3ID0gX3B5dGhvbl9hcnRpZmFjdHModGV4dCwgb3JpZ2luPXBhdGgpCiAgICAgICAgICAgIGFydGlmYWN0cy5leHRlbmQoYSkKICAgICAgICAgICAgd2FybmluZ3MuZXh0ZW5kKHcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXJ0aWZhY3RzLmFwcGVuZChBcnRpZmFjdChuYW1lPXBhdGgsIGtpbmQ9bGFuZywgY29udGVudD10ZXh0IGlmIHRleHQuZW5kc3dpdGgoIlxuIikgZWxzZSB0ZXh0ICsgIlxuIiwgb3JpZ2luPXBhdGgpKQoKICAgIHN0YXRzID0gewogICAgICAgICJzb3VyY2VzIjogbGVuKHNvdXJjZXMpLAogICAgICAgICJhcnRpZmFjdHMiOiBsZW4oYXJ0aWZhY3RzKSwKICAgICAgICAia2luZHMiOiB7azogc3VtKDEgZm9yIGEgaW4gYXJ0aWZhY3RzIGlmIGEua2luZCA9PSBrKSBmb3IgayBpbiBzb3J0ZWQoe2Eua2luZCBmb3IgYSBpbiBhcnRpZmFjdHN9KX0sCiAgICB9CiAgICByZXR1cm4gUmVmYWN0b3JSZXN1bHQoYXJ0aWZhY3RzPWFydGlmYWN0cywgd2FybmluZ3M9d2FybmluZ3MsIHN0YXRzPXN0YXRzKQpkZWYgcHJvcG9zZV9tb2R1bGVzKHJlc3VsdDogUmVmYWN0b3JSZXN1bHQpIC0+IERpY3Rbc3RyLCBMaXN0W0FydGlmYWN0XV06CiAgICAiIiJHcm91cCBhcnRpZmFjdHMgaW50byBzdWdnZXN0ZWQgbW9kdWxlIGZpbGVzLgoKICAgIEhldXJpc3RpYzoKICAgIC0gaW1wb3J0cyBhcmUgZ3JvdXBlZCBpbnRvIGEgcGVyLW9yaWdpbiBwc2V1ZG8tbW9kdWxlCiAgICAtIGZ1bmN0aW9ucyB3aXRoIGhlbHBlci1pc2ggbmFtZXMgZ28gdG8gdXRpbHMucHkKICAgIC0gb3RoZXIgZGVmcyBnbyB0byBhIG1vZHVsZSBkZXJpdmVkIGZyb20gb3JpZ2luIGZpbGUgbmFtZQogICAgLSBub24tcHl0aG9uL3RleHQgYXJ0aWZhY3RzIGtlZXAgdGhlaXIgb3JpZ2luLWRlcml2ZWQgbmFtZXMKICAgICIiIgogICAgZ3JvdXBlZDogRGljdFtzdHIsIExpc3RbQXJ0aWZhY3RdXSA9IHt9CiAgICBmb3IgYSBpbiByZXN1bHQuYXJ0aWZhY3RzOgogICAgICAgIGlmIGEua2luZCBpbiB7Im1hcmtkb3duIiwgInRleHQifToKICAgICAgICAgICAgbW9kID0gYS5vcmlnaW4gb3IgYS5uYW1lCiAgICAgICAgZWxpZiBhLmtpbmQgPT0gImltcG9ydHMiOgogICAgICAgICAgICBiYXNlID0gUGF0aChhLm9yaWdpbikuc3RlbSBpZiBhLm9yaWdpbiBlbHNlICJtb2R1bGUiCiAgICAgICAgICAgIG1vZCA9IGYie2Jhc2V9LnB5IgogICAgICAgIGVsaWYgYS5raW5kIGluIHsiZnVuY3Rpb24iLCAiY2xhc3MiLCAiZW50cnlwb2ludCJ9OgogICAgICAgICAgICBubSA9IGEubmFtZS5sb3dlcigpCiAgICAgICAgICAgIGlmIGFueSh0IGluIG5tIGZvciB0IGluICgidXRpbCIsICJoZWxwZXIiLCAicGFyc2VfIiwgInJlYWRfIiwgIndyaXRlXyIsICJzbHVnIiwgIm5vcm1hbGl6ZSIpKToKICAgICAgICAgICAgICAgIG1vZCA9ICJ1dGlscy5weSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJhc2UgPSBQYXRoKGEub3JpZ2luKS5zdGVtIGlmIGEub3JpZ2luIGVsc2UgIm1vZHVsZSIKICAgICAgICAgICAgICAgIG1vZCA9IGYie2Jhc2V9LnB5IgogICAgICAgIGVsc2U6ICAjIG1vZHVsZS91bmtub3duCiAgICAgICAgICAgIG1vZCA9IFBhdGgoYS5vcmlnaW4pLm5hbWUgaWYgYS5vcmlnaW4gZWxzZSAibW9kdWxlLnB5IgogICAgICAgIGdyb3VwZWQuc2V0ZGVmYXVsdChtb2QsIFtdKS5hcHBlbmQoYSkKCiAgICAjIHN0YWJsZSBvcmRlcmluZzogaW1wb3J0cyBmaXJzdCwgdGhlbiBjbGFzc2VzLCB0aGVuIGZ1bmN0aW9ucywgdGhlbiBlbnRyeXBvaW50L3RleHQKICAgIG9yZGVyID0geyJpbXBvcnRzIjogMCwgImNsYXNzIjogMSwgImZ1bmN0aW9uIjogMiwgImVudHJ5cG9pbnQiOiAzLCAibW9kdWxlIjogNCwgIm1hcmtkb3duIjogNSwgInRleHQiOiA2fQogICAgZm9yIG1vZCwgaXRlbXMgaW4gbGlzdChncm91cGVkLml0ZW1zKCkpOgogICAgICAgIGdyb3VwZWRbbW9kXSA9IHNvcnRlZChpdGVtcywga2V5PWxhbWJkYSB4OiAob3JkZXIuZ2V0KHgua2luZCwgOTkpLCB4Lm5hbWUpKQogICAgcmV0dXJuIGdyb3VwZWQKZGVmIHJlZmFjdG9yX2FuZF9tb2R1bGFyaXplKHNvdXJjZXM6IE1hcHBpbmdbc3RyLCBzdHJdKSAtPiBUdXBsZVtSZWZhY3RvclJlc3VsdCwgRGljdFtzdHIsIHN0cl1dOgogICAgIiIiRW5kLXRvLWVuZCBoZWxwZXIgcmV0dXJuaW5nIGFuYWx5c2lzIHBsdXMgcmVuZGVyZWQgbW9kdWxlIHRleHRzLiIiIgogICAgcmVzdWx0ID0gYW5hbHl6ZV9zb3VyY2VzKHNvdXJjZXMpCiAgICBtb2R1bGVzOiBEaWN0W3N0ciwgc3RyXSA9IHt9CiAgICBmb3IgbW9kLCBpdGVtcyBpbiBwcm9wb3NlX21vZHVsZXMocmVzdWx0KS5pdGVtcygpOgogICAgICAgIGlmIG1vZC5lbmRzd2l0aCgiLnB5Iik6CiAgICAgICAgICAgIGJvZHkgPSAiXG5cbiIuam9pbihpLmNvbnRlbnQucnN0cmlwKCJcbiIpIGZvciBpIGluIGl0ZW1zKS5yc3RyaXAoKSArICJcbiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBib2R5ID0gIlxuIi5qb2luKGkuY29udGVudC5yc3RyaXAoIlxuIikgZm9yIGkgaW4gaXRlbXMpLnJzdHJpcCgpICsgIlxuIgogICAgICAgIG1vZHVsZXNbbW9kXSA9IGJvZHkKICAgIHJldHVybiByZXN1bHQsIG1vZHVsZXMK\"}\nDIR_STATE:[\"src/refactor_modularize/__init__.py\",\"src/refactor_modularize/export.py\",\"src/refactor_modularize/refactor.py\",\"src/refactor_modularize/utils.py\"]"
        }
      ],
      "role": "assistant"
    }
  ],
  "codeResults": []
}